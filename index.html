<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e3a8a">
    <title>Gulistan Supermarket & Halal Meat - 187-189 Thomas st Dandenong</title>
    <link rel="icon" href="data:image/png;base64,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" type="image/png">
    <link rel="apple-touch-icon" href="data:image/png;base64,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" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            --primary: #1e3a8a;
            --secondary: #3b82f6;
            --dark: #0f172a;
            --glass: rgba(15, 23, 42, 0.7);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; width: 100%; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #020617 0%, #1e293b 100%);
            color: #f1f5f9;
            min-height: 100vh;
            -webkit-user-select: text;
            user-select: text;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .glass {
            background: var(--glass);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 8px;
        }
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            color: white;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        .btn-primary { background: var(--secondary); }
        .btn-primary:hover { background: #2563eb; }
        .btn-danger { background: #ef4444; }
        .btn-danger:hover { background: #dc2626; }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        .input {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 14px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        /* Safari date/time input styling */
        input[type="date"],
        input[type="time"],
        input[type="datetime-local"],
        input[type="month"],
        input[type="week"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        /* Safari number input remove spinners */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        .input:focus { outline: none; border-color: var(--secondary); }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            min-width: 600px;
        }
        th {
            background: rgba(0, 0, 0, 0.3);
            text-align: left;
            border-bottom: 2px solid var(--secondary);
            font-weight: 600;
        }
        tr:hover { background: rgba(59, 130, 246, 0.05); }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        .badge-success { background: rgba(16, 185, 129, 0.2); color: #34d399; }
        .badge-danger { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        .tab-btn {
            padding: 8px 16px;
            background: rgba(59, 130, 246, 0.2);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            margin-right: 8px;
        }
        .tab-btn.active {
            background: var(--secondary);
        }
        .tab-btn:hover {
            background: var(--secondary);
        }
        .tab-content {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--glass);
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-close { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px; }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 6px;
            color: white;
            z-index: 2000;
            display: none;
        }
        .notification.show { display: block; }
        .notification.success { background: #10b981; }
        .notification.error { background: #ef4444; }
        .tab { display: none; }
        .tab.active { display: block; }
        .loading {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #cbd5e1;
            padding: 10px 0;
        }
        .spinner {
            width: 16px; height: 16px;
            border: 2px solid rgba(255,255,255,0.2);
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .nav-tab {
            padding: 10px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #cbd5e1;
            cursor: pointer;
            border-radius: 6px;
            margin-right: 10px;
            transition: all 0.2s;
        }
        .nav-tab:hover { background: rgba(255, 255, 255, 0.2); }
        .nav-tab.active {
            background: var(--secondary);
            color: white;
            font-weight: 600;
        }
        /* Print styles */
        @media print {
            @page { margin: 12mm; }
            body { background: white; color: black; }
            html, body { overflow: visible !important; }
            .no-print { display: none !important; }
            .print-header { display: block !important; }
            .glass { background: white !important; border: none !important; }
            table th { background: #f3f4f6 !important; color: #111827 !important; border-bottom-color: #e5e7eb !important; }
            table td { border-bottom-color: #e5e7eb !important; color: #111827 !important; }
            .bar { display: none !important; }
            .modal, .modal-content, #print-overlay { position: static !important; background: white !important; }
            .modal-content { max-height: none !important; overflow: visible !important; box-shadow: none !important; }
            * { scrollbar-width: none !important; }
            *::-webkit-scrollbar { display: none !important; }
        }
        .print-header { display: block; text-align: center; margin-bottom: 16px; }
        .toolbar-btn { font-size: 12px; padding: 6px 10px; }
        #print-overlay .modal-content { max-height: none; overflow: visible; }
        #print-content { overflow: visible; }
        
        /* Action buttons responsive wrapper */
        .action-buttons {
            display: flex;
            flex-direction: row;
            gap: 6px;
            flex-wrap: wrap;
            max-width: 100%;
        }
        
        @media (max-width: 480px) {
            .action-buttons {
                gap: 3px;
                flex-wrap: nowrap;
                flex-direction: row;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                justify-content: flex-start;
                align-items: center;
            }
            .toolbar-btn {
                padding: 2px 3px !important;
                font-size: 11px !important;
                min-width: 28px;
                min-height: 28px;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }
            .toolbar-btn i { font-size: 14px; }
        }
        
        @media (max-width: 340px) {
            .action-buttons {
                gap: 2px;
                flex-wrap: nowrap;
                flex-direction: row;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                align-items: center;
            }
            .toolbar-btn {
                padding: 2px 3px !important;
                font-size: 9px !important;
                min-width: 24px;
                min-height: 24px;
                flex-shrink: 0;
            }
            .toolbar-btn i { font-size: 12px; }
        }
        
        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            body { font-size: 14px; }
            .max-w-7xl { padding: 8px; }
            h1 { font-size: 24px !important; }
            h2 { font-size: 18px !important; }
            h3 { font-size: 16px !important; }
            h4, h5, h6 { font-size: 14px !important; }
            .glass { padding: 12px !important; margin-bottom: 12px !important; }
            .modal-content {
                width: 95%;
                max-width: 100%;
                padding: 20px;
                max-height: 90vh;
            }
            .modal-header { margin-bottom: 15px; }
            .form-group { margin-bottom: 12px; }
            .form-label { font-size: 12px; }
            .input { padding: 8px; font-size: 14px; }
            .btn { padding: 8px 12px; font-size: 12px; }
            .toolbar-btn { font-size: 11px; padding: 4px 6px; }
            table { margin: 12px 0; }
            th, td { padding: 6px 4px !important; font-size: 12px; }
            .tab-btn { padding: 6px 12px; font-size: 12px; margin-right: 4px; }
            .nav-tab { padding: 8px 12px; font-size: 12px; }
            .badge { font-size: 11px; padding: 3px 10px; }
            .notification { top: 10px; right: 10px; padding: 10px 15px; font-size: 12px; }
            .text-sm { font-size: 12px !important; }
            .text-xs { font-size: 10px !important; }
            .flex { flex-wrap: wrap; }
            .gap-4 { gap: 8px; }
            .gap-2 { gap: 4px; }
            .overflow-x-auto { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .grid { gap: 8px !important; }
            
            /* Responsive grid columns */
            .grid-cols-1.md\:grid-cols-4 { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
            .grid-cols-1.md\:grid-cols-7 { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
            .grid-cols-1.md\:grid-cols-3 { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
            
            /* Action buttons stack on mobile */
            .flex.gap-2 { flex-wrap: wrap; }
            
            /* Ensure company group headers are readable */
            [style*="display:flex"][style*="justify-content:space-between"] {
                flex-direction: column;
                gap: 8px !important;
            }
            
            /* Make tables scrollable horizontally on mobile */
            .overflow-x-auto {
                overflow-x: auto !important;
                -webkit-overflow-scrolling: touch !important;
            }
            .overflow-x-auto > div > table,
            .overflow-x-auto table { 
                display: table;
                width: 100%;
                table-layout: auto;
            }
            .overflow-x-auto table th,
            .overflow-x-auto table td {
                white-space: nowrap;
            }
        }
        
        @media (max-width: 480px) {
            body { font-size: 13px; }
            h1 { font-size: 20px !important; }
            h2 { font-size: 16px !important; }
            h3 { font-size: 14px !important; }
            h4, h5, h6 { font-size: 12px !important; }
            .glass { padding: 10px !important; margin-bottom: 10px !important; }
            .modal-content { padding: 15px; }
            .modal-header { margin-bottom: 15px; }
            .form-label { font-size: 11px; }
            .form-group { margin-bottom: 10px; }
            .input { padding: 6px; font-size: 13px; }
            .btn { padding: 6px 10px; font-size: 11px; }
            .toolbar-btn { font-size: 10px; padding: 3px 5px; }
            .nav-tab { padding: 6px 10px; font-size: 11px; }
            .tab-btn { padding: 4px 10px; font-size: 11px; margin-right: 2px; }
            th, td { padding: 4px 2px !important; font-size: 11px; }
            .badge { font-size: 10px; padding: 2px 8px; }
            .notification { top: 8px; right: 8px; padding: 8px 12px; font-size: 11px; }
            .text-sm { font-size: 11px !important; }
            .text-xs { font-size: 9px !important; }
            .text-2xl { font-size: 18px !important; }
            .text-3xl { font-size: 20px !important; }
            .flex.items-center.justify-between { flex-direction: column; align-items: flex-start; gap: 8px; }
            .form-group { margin-bottom: 10px; }
            
            /* Enhanced table scrolling for very small screens */
            table { 
                min-width: 500px;
            }
            
            /* Vertical layout for form groups */
            .grid { grid-template-columns: 1fr !important; }
            
            /* Stack company header info vertically */
            [style*="display:flex"] { flex-wrap: wrap; }
        }
        
        /* Extra small devices (320px and below) */
        @media (max-width: 340px) {
            body { font-size: 12px; }
            h1 { font-size: 18px !important; }
            h2 { font-size: 14px !important; }
            h3 { font-size: 12px !important; }
            .glass { padding: 8px !important; margin-bottom: 8px !important; }
            .modal-content { padding: 12px; }
            .form-label { font-size: 10px; }
            .input { padding: 5px; font-size: 12px; }
            .btn { padding: 5px 8px; font-size: 10px; }
            .toolbar-btn { font-size: 9px; padding: 2px 4px; }
            .nav-tab { padding: 5px 8px; font-size: 10px; }
            .tab-btn { padding: 3px 8px; font-size: 10px; }
            th, td { padding: 3px 1px !important; font-size: 10px; }
            .badge { font-size: 9px; padding: 1px 6px; }
            .text-sm { font-size: 10px !important; }
            .text-xs { font-size: 8px !important; }
            .text-2xl { font-size: 16px !important; }
            .text-3xl { font-size: 18px !important; }
        }
        
        /* Touch-friendly adjustments */
        @media (hover: none) and (pointer: coarse) {
            .btn { padding: 12px 16px; min-height: 44px; }
            .input { padding: 12px; min-height: 44px; }
            .tab-btn { padding: 10px 16px; min-height: 44px; }
            .toolbar-btn { min-height: 40px; min-width: 40px; }
            th, td { padding: 8px 6px !important; }
        }
        
        /* Cross-browser compatibility tweaks */
        select { 
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%233b82f6' stroke-width='2'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 20px;
            padding-right: 32px;
        }
        
        /* Firefox focus outline fix */
        @-moz-document url-prefix() {
            .input { -moz-outline: none; }
        }
        
        /* Edge smooth scrolling */
        html { scroll-behavior: smooth; }
        
        /* Safari text selection styling */
        ::selection {
            background: rgba(59, 130, 246, 0.5);
            color: white;
        }
        ::-moz-selection {
            background: rgba(59, 130, 246, 0.5);
            color: white;
        }
    </style>
</head>
<body>
    <div class="max-w-7xl mx-auto p-4 sm:p-6">
        <!-- Header -->
        <div class="glass p-6 mb-6 rounded-xl">
            <div class="flex items-center justify-between gap-4 flex-wrap">
                <div class="flex items-center gap-3">
                    <img src="data:image/png;base64,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" alt="Logo" class="w-16 h-16 md:w-12 md:h-12 rounded-xl object-cover" onerror="this.style.display='none'" style="flex-shrink:0">
                    <div>
                        <h1 class="text-3xl font-bold mb-1">Gulistan Supermarket & Halal Meat</h1>
                        <p class="text-gray-400 text-sm">187-189 Thomas st Dandenong</p>
                    </div>
                </div>
                <div class="flex-1 min-w-[160px]" id="firebase-status" style="display:none">
                    <p class="text-sm" id="connection-status">Connecting...</p>
                    <p class="text-xs text-gray-400" id="build-version"></p>
                </div>
                <div class="flex items-center gap-2 flex-wrap justify-end"></div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="glass p-4 mb-6 rounded-xl overflow-x-auto">
            <div class="flex gap-2 whitespace-nowrap">
                <button class="nav-tab active" data-tab="expenses"><i class="fas fa-receipt mr-2"></i>Expenses</button>
                <button class="nav-tab" data-tab="investments"><i class="fas fa-hand-holding-usd mr-2"></i>Investments</button>
                <button class="nav-tab" data-tab="suppliers"><i class="fas fa-truck mr-2"></i>Suppliers</button>
                <button class="nav-tab" data-tab="invoices"><i class="fas fa-file-invoice mr-2"></i>Invoices</button>
                <button class="nav-tab" data-tab="exchange"><i class="fas fa-exchange-alt mr-2"></i>Exchange</button>
                <button class="nav-tab" data-tab="cash"><i class="fas fa-coins mr-2"></i>Cash</button>
                <button class="nav-tab" data-tab="outstanding"><i class="fas fa-star mr-2"></i>Outstanding</button>
            </div>
        </div>

        <!-- Content -->
        <div class="tab active" id="tab-expenses">
            <div class="glass p-6 rounded-xl">
                <h2 class="text-2xl font-bold mb-4"><i class="fas fa-receipt mr-2"></i>Expenses</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <input type="text" id="expense-desc" class="input" placeholder="Expense description" list="expenses-list">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount</label>
                        <input type="number" id="expense-amount" class="input" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" id="expense-date" class="input">
                    </div>
                    <div class="form-group flex items-end">
                        <button class="btn btn-primary w-full" onclick="addExpense()"><i class="fas fa-plus mr-2"></i>Add</button>
                    </div>
                </div>
                <div id="expenses-totals" class="text-sm text-gray-300"></div>
                <div class="overflow-x-auto">
                    <div id="expenses-table"></div>
                </div>
            </div>
        </div>

        <div class="tab" id="tab-investments">
            <div class="glass p-6 rounded-xl">
                <h2 class="text-2xl font-bold mb-4"><i class="fas fa-hand-holding-usd mr-2"></i>Investments</h2>
                <div class="grid grid-cols-1 md:grid-cols-7 gap-4 mb-6">
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <input type="text" id="inv-name" class="input" placeholder="Investment description">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Investor</label>
                        <select id="inv-investor" class="input">
                            <option>Haji Hayat</option>
                            <option>Abbas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount</label>
                        <input type="number" id="inv-amount" class="input" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Paid to</label>
                        <select id="inv-paid-to" class="input">
                            <option>Shop</option>
                            <option>Real Estate</option>
                            <option>Cash</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" id="inv-date" class="input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Method</label>
                        <select id="inv-method" class="input">
                            <option>Cash</option>
                            <option>Bank Transfer</option>
                        </select>
                    </div>
                    <div class="form-group flex items-end">
                        <button class="btn btn-primary w-full" onclick="addInvestment()"><i class="fas fa-plus mr-2"></i>Add</button>
                    </div>
                </div>

                <!-- Tabs for switching views -->
                <div class="flex gap-2 mb-4 border-b border-gray-600 pb-2">
                    <button class="tab-btn active" onclick="switchInvTab('all')" id="tab-btn-all">All</button>
                    <button class="tab-btn" onclick="switchInvTab('hayat')" id="tab-btn-hayat">Haji Hayat</button>
                    <button class="tab-btn" onclick="switchInvTab('abbas')" id="tab-btn-abbas">Abbas</button>
                </div>

                <!-- All Investments -->
                <div id="inv-all" class="tab-content">
                    <div class="flex items-center gap-2 mb-2">
                        <input id="investments-search" class="input" placeholder="Search investments" style="max-width:320px">
                        <button class="btn btn-primary toolbar-btn no-print" onclick="openPrintPreviewForTable('investments')"><i class="fas fa-eye mr-1"></i>Preview</button>
                        <button class="btn btn-primary toolbar-btn no-print" onclick="printTable('investments')"><i class="fas fa-print mr-1"></i>Print</button>
                        <button class="btn btn-success toolbar-btn no-print" onclick="exportInvestmentsPDF('all')"><i class="fas fa-file-pdf mr-1"></i>PDF</button>
                        <button class="btn btn-primary toolbar-btn no-print" onclick="exportCSV('investments')"><i class="fas fa-file-export mr-1"></i>Export</button>
                        <button class="btn btn-primary toolbar-btn no-print" onclick="shareTable('investments')"><i class="fas fa-share-alt mr-1"></i>Share</button>
                    </div>
                    <div class="overflow-x-auto">
                        <div id="investments-table"></div>
                    </div>
                    <div id="investments-totals" class="text-sm text-gray-300 mt-2 font-semibold"></div>
                </div>

                <!-- Haji Hayat -->
                <div id="inv-hayat" class="tab-content" style="display:none;">
                    <div class="flex items-center gap-2 mb-2">
                        <input id="inv-hayat-search" class="input" placeholder="Search Haji Hayat" style="max-width:320px">
                        <button class="btn btn-primary toolbar-btn no-print" onclick="shareInvestorTab('hayat')"><i class="fas fa-share-alt mr-1"></i>Share</button>
                        <button class="btn btn-primary toolbar-btn no-print" onclick="printInvestorTab('hayat')"><i class="fas fa-print mr-1"></i>Print</button>
                        <button class="btn btn-success toolbar-btn no-print" onclick="exportInvestmentsPDF('hayat')"><i class="fas fa-file-pdf mr-1"></i>PDF</button>
                    </div>
                    <div class="overflow-x-auto">
                        <div id="investments-hayat-table"></div>
                    </div>
                    <div id="inv-hayat-totals" class="text-sm text-gray-300 mt-2 font-semibold"></div>
                </div>

                <!-- Abbas -->
                <div id="inv-abbas" class="tab-content" style="display:none;">
                    <div class="flex items-center gap-2 mb-2">
                        <input id="inv-abbas-search" class="input" placeholder="Search Abbas" style="max-width:320px">
                        <button class="btn btn-primary toolbar-btn no-print" onclick="shareInvestorTab('abbas')"><i class="fas fa-share-alt mr-1"></i>Share</button>
                        <button class="btn btn-primary toolbar-btn no-print" onclick="printInvestorTab('abbas')"><i class="fas fa-print mr-1"></i>Print</button>
                        <button class="btn btn-success toolbar-btn no-print" onclick="exportInvestmentsPDF('abbas')"><i class="fas fa-file-pdf mr-1"></i>PDF</button>
                    </div>
                    <div class="overflow-x-auto">
                        <div id="investments-abbas-table"></div>
                    </div>
                    <div id="inv-abbas-totals" class="text-sm text-gray-300 mt-2 font-semibold"></div>
                </div>
            </div>
        </div>

        <div class="tab" id="tab-suppliers">
            <div class="glass p-6 rounded-xl">
                <h2 class="text-2xl font-bold mb-4"><i class="fas fa-truck mr-2"></i>Suppliers</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="form-group">
                        <label class="form-label">Name</label>
                        <input type="text" id="supp-name" class="input" placeholder="Company name" list="companies-list">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input type="text" id="supp-phone" class="input" placeholder="0422622642">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Product Details</label>
                        <input type="text" id="supp-details" class="input" placeholder="Product Details">
                    </div>
                    <div class="form-group flex items-end">
                        <button class="btn btn-primary w-full" onclick="addSupplier()"><i class="fas fa-plus mr-2"></i>Add</button>
                    </div>
                </div>
                <!-- Quick add companies into suppliers -->
                <div class="flex items-center gap-2 mb-2">
                    <select id="suppliers-quick-select" class="input" style="max-width:320px"></select>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="addSupplierQuick()"><i class="fas fa-plus mr-1"></i>Quick Add</button>
                </div>
                <div class="flex items-center gap-2 mb-2">
                    <input id="suppliers-search" class="input" placeholder="Search suppliers" style="max-width:320px">
                    <button class="btn btn-primary toolbar-btn no-print" onclick="openPrintPreviewForTable('suppliers')"><i class="fas fa-eye mr-1"></i>Preview</button>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="printTable('suppliers')"><i class="fas fa-print mr-1"></i>Print</button>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="exportCSV('suppliers')"><i class="fas fa-file-export mr-1"></i>Export</button>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="shareTable('suppliers')"><i class="fas fa-share-alt mr-1"></i>Share</button>
                </div>
                <div class="overflow-x-auto">
                    <div id="suppliers-table"></div>
                </div>
                <div id="suppliers-totals" class="text-sm text-gray-300 mt-2"></div>
            </div>
        </div>

        <div class="tab" id="tab-invoices">
            <div class="glass p-6 rounded-xl">
                <h2 class="text-2xl font-bold mb-4"><i class="fas fa-file-invoice mr-2"></i>Invoices</h2>
                <div class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-6">
                    <div class="form-group">
                        <label class="form-label">Invoice #</label>
                        <input type="text" id="inv-num" class="input" placeholder="Invoice number">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Company</label>
                        <input type="text" id="inv-customer" class="input" placeholder="Company name" list="companies-list" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Invoice Date</label>
                        <input type="date" id="inv-invoice-date" class="input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount</label>
                        <input type="number" id="inv-price" class="input" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">GST Type</label>
                        <select id="inv-gst-type" class="input">
                            <option value="include">include</option>
                            <option value="exclude">exclude</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Paid</label>
                        <select id="inv-paid" class="input">
                            <option value="No">Not Paid</option>
                            <option value="Full">Paid Full</option>
                            <option value="Half">Paid Half</option>
                            <option value="Partially">Paid Partially</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount Paid</label>
                        <input type="number" id="inv-amount-paid" class="input" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Paid On</label>
                        <input type="date" id="inv-paid-on" class="input" disabled>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Payment Method</label>
                        <select id="inv-payment-method" class="input">
                            <option value="cash">cash</option>
                            <option value="bank">bank</option>
                            <option value="card">card</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">BSB</label>
                        <input type="text" id="inv-bsb" class="input" placeholder="033174">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Account</label>
                        <input type="text" id="inv-account" class="input" placeholder="Account number">
                    </div>
                    <div class="form-group flex items-end">
                        <button class="btn btn-primary w-full" onclick="addInvoice()"><i class="fas fa-plus mr-2"></i>Add</button>
                    </div>
                </div>
                <div class="flex items-center gap-2 mb-2">
                    <input id="invoices-search" class="input" placeholder="Search invoices" style="max-width:320px">
                    <div class="flex items-center gap-2">
                        <label class="text-sm text-gray-300">GST %</label>
                        <input id="gst-rate" class="input" type="number" value="10" min="0" max="100" style="width:90px">
                    </div>
                    <button class="btn btn-success toolbar-btn no-print" onclick="expandAllInvoiceGroups()" title="Expand All Groups"><i class="fas fa-expand-alt mr-1"></i>Expand All</button>
                    <button class="btn btn-danger toolbar-btn no-print" onclick="collapseAllInvoiceGroups()" title="Collapse All Groups"><i class="fas fa-compress-alt mr-1"></i>Collapse All</button>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="openPrintPreviewForTable('invoices')"><i class="fas fa-eye mr-1"></i>Preview</button>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="printTable('invoices')"><i class="fas fa-print mr-1"></i>Print</button>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="exportCSV('invoices')"><i class="fas fa-file-export mr-1"></i>Export</button>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="shareTable('invoices')"><i class="fas fa-share-alt mr-1"></i>Share</button>
                </div>
                <div class="overflow-x-auto">
                    <div id="invoices-table"></div>
                </div>
                <div id="invoices-totals" class="text-sm text-gray-300 mt-2"></div>
            </div>
        </div>

        <div class="tab" id="tab-exchange">
            <div class="glass p-6 rounded-xl">
                <h2 class="text-2xl font-bold mb-4"><i class="fas fa-exchange-alt mr-2"></i>Money Exchange</h2>
                <div class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-6">
                    <div class="form-group md:col-span-2">
                        <label class="form-label">Amount (AUD)</label>
                        <input type="number" id="exc-amount" class="input" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Service</label>
                        <select id="exc-service" class="input">
                            <option>RIA</option>
                            <option>Western Union</option>
                            <option>Money Gram</option>
                            <option>Hawala</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cash Type</label>
                        <select id="exc-type" class="input">
                            <option value="in">Cash In</option>
                            <option value="out">Cash Out</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select id="exc-status" class="input">
                            <option>Pending</option>
                            <option>Paid</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Paid On</label>
                        <input type="date" id="exc-paid-on" class="input" disabled>
                    </div>
                    <div class="form-group flex items-end">
                        <button class="btn btn-primary w-full" onclick="addExchange()"><i class="fas fa-plus mr-2"></i>Add</button>
                    </div>
                </div>
                <div class="flex items-center gap-2 mb-2">
                    <input id="exchange-search" class="input" placeholder="Search exchange" style="max-width:320px">
                    <select id="exchange-service-filter" class="input" style="max-width:200px">
                        <option value="all">All Services</option>
                        <option value="RIA">RIA</option>
                        <option value="Western Union">Western Union</option>
                        <option value="Money Gram">Money Gram</option>
                        <option value="Hawala">Hawala</option>
                    </select>
                    <select id="exchange-cash-filter" class="input" style="max-width:160px">
                        <option value="all">All Cash</option>
                        <option value="in">Cash In</option>
                        <option value="out">Cash Out</option>
                    </select>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="openPrintPreviewForTable('exchange')"><i class="fas fa-eye mr-1"></i>Preview</button>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="printTable('exchange')"><i class="fas fa-print mr-1"></i>Print</button>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="exportCSV('exchange')"><i class="fas fa-file-export mr-1"></i>Export</button>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="shareTable('exchange')"><i class="fas fa-share-alt mr-1"></i>Share</button>
                </div>
                <div class="overflow-x-auto">
                    <div id="exchange-table"></div>
                </div>
                <div id="exchange-totals" class="text-sm text-gray-300 mt-2"></div>
            </div>
        </div>

        <div class="tab" id="tab-cash">
            <div class="glass p-6 rounded-xl">
                <h2 class="text-2xl font-bold mb-4"><i class="fas fa-coins mr-2"></i>Cash Drawer</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <input type="text" id="cash-desc" class="input" placeholder="Description">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Type</label>
                        <select id="cash-type" class="input">
                            <option value="in">Cash In</option>
                            <option value="out">Cash Out</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount</label>
                        <input type="number" id="cash-amount" class="input" placeholder="0.00">
                    </div>
                    <div class="form-group flex items-end">
                        <button class="btn btn-primary w-full" onclick="addCash()"><i class="fas fa-plus mr-2"></i>Add</button>
                    </div>
                </div>
                <div id="cash-totals" class="text-sm text-gray-300"></div>
                <div class="overflow-x-auto">
                    <div id="cash-table"></div>
                </div>
            </div>
        </div>

        <div class="tab" id="tab-outstanding">
            <div class="glass p-6 rounded-xl">
                <h2 class="text-2xl font-bold mb-4"><i class="fas fa-star mr-2"></i>Outstanding</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="form-group">
                        <label class="form-label">Customer</label>
                        <input type="text" id="out-customer" class="input" placeholder="Customer name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Amount</label>
                        <input type="number" id="out-amount" class="input" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" id="out-date" class="input">
                    </div>
                    <div class="form-group flex items-end">
                        <button class="btn btn-primary w-full" onclick="addOutstanding()"><i class="fas fa-plus mr-2"></i>Add</button>
                    </div>
                </div>
                <div class="flex items-center gap-2 mb-2">
                    <button class="btn btn-success toolbar-btn no-print" onclick="expandAllOutstandingGroups()" title="Expand All Groups"><i class="fas fa-expand-alt mr-1"></i>Expand All</button>
                    <button class="btn btn-danger toolbar-btn no-print" onclick="collapseAllOutstandingGroups()" title="Collapse All Groups"><i class="fas fa-compress-alt mr-1"></i>Collapse All</button>
                </div>
                <div id="outstanding-totals" class="text-sm text-gray-300"></div>
                <div class="overflow-x-auto">
                    <div id="outstanding-table"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>
    <!-- Datalists -->
    <datalist id="expenses-list">
        <option value="Insurance"></option>
        <option value="Store Rent"></option>
        <option value="Utilities"></option>
        <option value="Electricity"></option>
        <option value="Water"></option>
        <option value="Internet"></option>
        <option value="Maintenance"></option>
        <option value="Supplies"></option>
        <option value="Salaries"></option>
        <option value="Taxes"></option>
        <option value="Marketing"></option>
        <option value="Waste Disposal"></option>
        <option value="Security"></option>
        <option value="Cleaning"></option>
        <option value="Licenses"></option>
        <option value="Repairs"></option>
        <option value="Bank Fees"></option>
    </datalist>
    <!-- Edit Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-xl font-bold">Edit Record</h3>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <form id="edit-form"></form>
            <div class="mt-4 flex justify-between gap-2">
                <button class="btn btn-primary" id="payment-history-btn" style="display:none;" onclick="openPaymentHistoryModal(editState.id, document.querySelector('[name=\'num\']')?.value)" type="button"><i class="fas fa-history mr-2"></i>Payment History</button>
                <div class="flex gap-2">
                    <button class="btn btn-danger" onclick="closeEditModal()" type="button">Cancel</button>
                    <button class="btn btn-success" onclick="saveEdits(event)" type="submit">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment History Modal -->
    <div id="payment-history-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-xl font-bold">Payment History</h3>
                <button class="modal-close" onclick="closePaymentHistoryModal()">&times;</button>
            </div>
            <div id="payment-history-content" style="max-height: 400px; overflow-y: auto;"></div>
            <div class="mt-4 mb-4">
                <h4 class="text-lg font-bold mb-3">Record New Payment</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="form-group">
                        <label class="form-label">Amount</label>
                        <input type="number" id="payment-amount" class="input" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Paid On</label>
                        <input type="date" id="payment-date" class="input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Method</label>
                        <select id="payment-method" class="input">
                            <option value="cash">Cash</option>
                            <option value="bank">Bank</option>
                            <option value="card">Card</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="flex justify-end gap-2">
                <button class="btn btn-danger" onclick="closePaymentHistoryModal()" type="button">Close</button>
                <button class="btn btn-success" onclick="recordPayment()" type="button">Record Payment</button>
            </div>
        </div>
    </div>

    <!-- Print Preview Overlay -->
    <div id="print-overlay" class="modal">
        <div class="modal-content" style="max-width: 1000px; width: 95%;">
            <div class="modal-header">
                <h3 class="text-xl font-bold">Print Preview</h3>
                <button class="modal-close" onclick="closePrintPreview()">&times;</button>
            </div>
            <div class="mb-4 no-print flex gap-2 justify-end">
                <button class="btn btn-primary toolbar-btn" onclick="printFromOverlay()"><i class="fas fa-print mr-1"></i>Print</button>
                <button class="btn btn-primary toolbar-btn" onclick="printFromOverlay()"><i class="fas fa-file-pdf mr-1"></i>Save as PDF</button>
                <button class="btn btn-primary toolbar-btn" onclick="shareFromOverlay()"><i class="fas fa-share-alt mr-1"></i>Share</button>
                <button class="btn btn-danger toolbar-btn" onclick="closePrintPreview()">Back to App</button>
            </div>
            <div id="print-content" class="glass p-4" style="background:white;color:#111827"></div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBcHY8XLvoaKVyilWHwfNdOYpqGQ9Gswik",
            authDomain: "gulistan-store.firebaseapp.com",
            projectId: "gulistan-store",
            storageBucket: "gulistan-store.firebasestorage.app",
            messagingSenderId: "626332439320",
            appId: "1:626332439320:web:a44e7b219d3418baed846d"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // LocalDB Fallback
        const LocalDB = {
            getCollection(name) {
                try { return JSON.parse(localStorage.getItem(`gulistan_${name}`) || '[]'); }
                catch(e) { return []; }
            },
            saveCollection(name, data) {
                try { localStorage.setItem(`gulistan_${name}`, JSON.stringify(data)); }
                catch(e) { console.warn('LocalDB save error (Tracking Prevention?):', e); }
            },
            addDoc(name, data) {
                const id = Date.now().toString() + Math.random().toString(36).substr(2, 9);
                const col = this.getCollection(name);
                col.push({ id, ...data, createdAt: new Date().toISOString() });
                this.saveCollection(name, col);
                return id;
            },
            updateDoc(name, id, data) {
                const col = this.getCollection(name);
                const idx = col.findIndex(d => d.id === id);
                if (idx !== -1) {
                    col[idx] = { ...col[idx], ...data };
                    this.saveCollection(name, col);
                }
            },
            deleteDoc(name, id) {
                const col = this.getCollection(name).filter(d => d.id !== id);
                this.saveCollection(name, col);
            },
            getDoc(name, id) {
                return this.getCollection(name).find(d => d.id === id);
            }
        };

        // No auth  read/write Firestore directly per your preference

        // Utilities
        function getGstRate() {
            const el = document.getElementById('gst-rate');
            const val = el ? parseFloat(el.value || '10') : 10;
            return (isNaN(val) ? 10 : val) / 100;
        }
        function normalizeName(name) {
            return (name || '').trim().replace(/\s+/g, ' ').toLowerCase().replace(/\b\w/g, c => c.toUpperCase());
        }
        function normalizeKey(value) {
            return (value || '').toString().trim().toLowerCase();
        }
        function getInvoicePayments(invoiceNum) {
            const key = normalizeKey(invoiceNum);
            return LocalDB.getCollection('payments').filter(p => normalizeKey(p.invoiceNum) === key);
        }
        function getInvoicePaidTotal(row) {
            const payments = getInvoicePayments(row.num);
            if (payments.length > 0) {
                return payments.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);
            }
            return parseFloat(row.amountPaid) || 0;
        }
        function getInvoiceBalance(row) {
            const total = parseFloat(row.amount) || 0;
            const payments = getInvoicePayments(row.num);
            if (payments.length > 0) {
                const paid = payments.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);
                return Math.max(0, total - paid);
            }
            const unpaid = parseFloat(row.amountUnpaid);
            if (!isNaN(unpaid)) return Math.max(0, unpaid);
            return Math.max(0, total - (parseFloat(row.amountPaid) || 0));
        }
        function notify(message, type = 'success') {
            const el = document.getElementById('notification');
            el.textContent = message;
            el.className = `notification ${type} show`;
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        const RenderCache = {
            invoices: [],
            outstanding: []
        };

        // Map logical tab names to Firestore collection names
        const CollectionMap = { outstanding: 'customers' };
        const CloudNameCandidates = {
            expenses: ['expenses', 'Expenses', 'Expense'],
            investments: ['investments', 'Investments', 'Investment'],
            suppliers: ['suppliers', 'Suppliers', 'Supplier'],
            invoices: ['invoices', 'Invoices', 'Invoice'],
            payments: ['payments', 'Payments', 'Payment'],
            exchange: ['exchange', 'Exchange'],
            cash: ['cash', 'Cash'],
            outstanding: ['customers', 'Outstanding', 'outstanding'],
            outstanding_payments: ['customer_payments', 'outstanding_payments', 'OutstandingPayments']
        };
        const CloudNameCacheKey = 'gulistan_cloud_names';
        function getCloudNameCache() {
            try { return JSON.parse(localStorage.getItem(CloudNameCacheKey) || '{}'); } catch { return {}; }
        }
        function setCloudNameCache(obj) {
            try { localStorage.setItem(CloudNameCacheKey, JSON.stringify(obj || {})); }
            catch(e) { console.warn('Cloud cache save error:', e); }
        }
        const resolveColl = (name) => {
            const cache = getCloudNameCache();
            return cache[name] || CollectionMap[name] || name;
        };

        // Field name mapping (cloud <-> local) per collection
        const FieldMapKey = 'gulistan_field_map';
        function getFieldMap() {
            try { return JSON.parse(localStorage.getItem(FieldMapKey) || '{}'); } catch { return {}; }
        }
        function setFieldMap(obj) {
            try { localStorage.setItem(FieldMapKey, JSON.stringify(obj || {})); }
            catch(e) { console.warn('Field map save error:', e); }
        }
        // Map a cloud doc to local keys
        function mapRead(collection, doc) {
            const fm = getFieldMap()[collection] || {};
            const mapped = { ...doc };
            Object.entries(fm).forEach(([localKey, cloudKey]) => {
                if (cloudKey in doc) {
                    mapped[localKey] = doc[cloudKey];
                }
            });
            // Special handling for investments: cloud 'name' holds investor
            if (collection === 'investments') {
                mapped.investor = mapped.investor ?? doc.name ?? mapped.investor;
                mapped.amount = mapped.amount ?? doc.amount ?? mapped.amount;
                mapped.date = mapped.date ?? doc.date ?? mapped.date;
            }
            // Special handling for invoices
            if (collection === 'invoices') {
                mapped.amount = mapped.amount ?? doc.totalAmount ?? doc.netAmount ?? mapped.amount;
                if (typeof mapped.paid === 'undefined' && typeof doc.status !== 'undefined') {
                    mapped.paid = (doc.status === 'paid') ? 'Yes' : 'No';
                }
                mapped.num = mapped.num ?? doc.invoiceNumber ?? mapped.num;
                mapped.customer = mapped.customer ?? doc.customer ?? mapped.customer;
                mapped.date = mapped.date ?? doc.date ?? mapped.date;
                mapped.paymentMethod = mapped.paymentMethod ?? doc.paymentMethod ?? mapped.paymentMethod;
                mapped.bsb = mapped.bsb ?? doc.bsb ?? mapped.bsb;
                // Set default amountPaid and amountUnpaid if missing
                const totalAmt = parseFloat(mapped.amount) || 0;
                if (typeof mapped.amountPaid === 'undefined' || mapped.amountPaid === null) {
                    mapped.amountPaid = (mapped.paid === 'Full' || mapped.paid === 'Yes') ? totalAmt : 0;
                }
                if (typeof mapped.amountUnpaid === 'undefined' || mapped.amountUnpaid === null) {
                    mapped.amountUnpaid = totalAmt - (parseFloat(mapped.amountPaid) || 0);
                }
            }
            return mapped;
        }
        // Map a local doc to cloud keys
        function mapWrite(collection, doc) {
            const fm = getFieldMap()[collection] || {};
            const mapped = { ...doc };
            Object.entries(fm).forEach(([localKey, cloudKey]) => {
                if (localKey in doc) {
                    mapped[cloudKey] = doc[localKey];
                }
            });
            // Special handling for investments: write investor to cloud 'name'
            if (collection === 'investments') {
                if (typeof mapped.name === 'undefined' && typeof doc.investor !== 'undefined') mapped.name = doc.investor;
                if (typeof mapped.amount === 'undefined' && typeof doc.amount !== 'undefined') mapped.amount = doc.amount;
                if (typeof mapped.date === 'undefined' && typeof doc.date !== 'undefined') mapped.date = doc.date;
            }
            // Special handling for invoices
            if (collection === 'invoices') {
                mapped.invoiceNumber = mapped.invoiceNumber ?? doc.num;
                mapped.totalAmount = mapped.totalAmount ?? doc.amount;
                mapped.status = mapped.status ?? ((doc.paid !== 'No') ? 'paid' : 'unpaid');
                // Ensure numeric GST fields
                if (typeof mapped.gstRate === 'undefined' && typeof doc.gstRate !== 'undefined') mapped.gstRate = doc.gstRate;
                if (typeof mapped.gstAmount === 'undefined' && typeof doc.gstAmount !== 'undefined') mapped.gstAmount = doc.gstAmount;
                if (typeof mapped.netAmount === 'undefined' && typeof doc.netAmount !== 'undefined') mapped.netAmount = doc.netAmount;
                if (typeof mapped.amountPaid === 'undefined' && typeof doc.amountPaid !== 'undefined') mapped.amountPaid = doc.amountPaid;
                if (typeof mapped.amountUnpaid === 'undefined' && typeof doc.amountUnpaid !== 'undefined') mapped.amountUnpaid = doc.amountUnpaid;
            }
            // Remove undefined values before sending to Firebase
            Object.keys(mapped).forEach(key => {
                if (mapped[key] === undefined) {
                    delete mapped[key];
                }
            });
            return mapped;
        }

        // Column schemas per collection (label + formatting)
        const Schema = {
            expenses: {
                columns: [
                    { key: 'desc', label: 'Description' },
                    { key: 'amount', label: 'Amount', type: 'currency' },
                    { key: 'date', label: 'Date', type: 'date' }
                ],
                totals: [{ key: 'amount', label: 'Total' }]
            },
            investments: {
                columns: [
                    { key: 'name', label: 'Description' },
                    { label: 'Haji Hayat', type: 'currency', value: r => (r.investor === 'Haji Hayat' ? (parseFloat(r.amount)||0) : 0) },
                    { label: 'Abbas', type: 'currency', value: r => (r.investor === 'Abbas' ? (parseFloat(r.amount)||0) : 0) },
                    { key: 'paidTo', label: 'Paid to' },
                    { key: 'date', label: 'Date', type: 'date' },
                    { key: 'method', label: 'Method' }
                ],
                totals: [
                    { key: 'amount', label: 'Total' },
                    { key: 'amount', label: 'Haji Hayat Total', filter: r => (r.investor === 'Haji Hayat') },
                    { key: 'amount', label: 'Abbas Total', filter: r => (r.investor === 'Abbas') }
                ]
            },
            suppliers: {
                columns: [
                    { key: 'name', label: 'Name' },
                    { key: 'phone', label: 'Phone', value: r => r.phone ? `<a href="tel:${r.phone}" style="color:#3b82f6;text-decoration:none" onclick="event.stopPropagation()">${r.phone}</a>` : 'N/A' },
                    { key: 'details', label: 'Product Details' }
                ]
            },
            invoices: {
                columns: [
                    { key: 'num', label: 'Invoice #' },
                    { key: 'customer', label: 'Company' },
                    { key: 'amount', label: 'Amount', type: 'currency' },
                    { label: 'Amount Paid', type: 'currency', value: r => {
                        return getInvoicePaidTotal(r);
                    }},
                    { label: 'Balance', type: 'currency', value: r => {
                        return getInvoiceBalance(r);
                    }},
                    { key: 'date', label: 'Date', type: 'date' },
                    { key: 'paid', label: 'Status' },
                    { key: 'paymentMethod', label: 'Payment Method' }
                ],
                totals: [
                    { key: 'amount', label: 'Total' },
                    { label: 'Total Paid', reducer: rows => {
                        return rows.reduce((sum, r) => sum + getInvoicePaidTotal(r), 0);
                    }},
                    { label: 'Total Balance', reducer: rows => {
                        return rows.reduce((sum, r) => sum + getInvoiceBalance(r), 0);
                    }},
                    { label: 'Total GST', reducer: rows => rows.reduce((s, r) => s + (parseFloat(r.amount) || 0), 0) * getGstRate() }
                ]
            },
            exchange: {
                columns: [
                    { key: 'amount', label: 'Amount (AUD)', type: 'currency' },
                    { key: 'service', label: 'Service' },
                    { key: 'cashType', label: 'Cash Type' },
                    { key: 'status', label: 'Status' },
                    { key: 'paidOn', label: 'Paid On', type: 'date' }
                ],
                totals: [
                    { key: 'amount', label: 'Total Amount' },
                    { key: 'amount', label: 'Total RIA', filter: r => r.service === 'RIA' },
                    { key: 'amount', label: 'Total Western Union', filter: r => r.service === 'Western Union' },
                    { key: 'amount', label: 'Total Money Gram', filter: r => r.service === 'Money Gram' },
                    { key: 'amount', label: 'Total Hawala', filter: r => r.service === 'Hawala' },
                    { key: 'amount', label: 'Cash In', filter: r => r.cashType === 'in' },
                    { key: 'amount', label: 'Cash Out', filter: r => r.cashType === 'out' }
                ]
            },
            cash: {
                columns: [
                    { key: 'desc', label: 'Description' },
                    { key: 'type', label: 'Type' },
                    { key: 'amount', label: 'Amount', type: 'currency' },
                    { key: 'date', label: 'Date', type: 'date' }
                ],
                totals: [
                    { key: 'amount', label: 'Cash In', filter: r => (r.type === 'in') },
                    { key: 'amount', label: 'Cash Out', filter: r => (r.type === 'out') },
                    { key: 'amount', label: 'Net', reducer: rows => rows.reduce((s, r) => s + (r.type === 'in' ? +(r.amount||0) : -(r.amount||0)), 0) }
                ]
            },
            outstanding: {
                columns: [
                    { key: 'customer', label: 'Customer' },
                    { key: 'amount', label: 'Amount', type: 'currency' },
                    { label: 'Amount Paid', type: 'currency', value: r => {
                        const payments = LocalDB.getCollection('outstanding_payments').filter(p => String(p.outstandingId).trim() === String(r.id).trim());
                        return payments.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);
                    }},
                    { label: 'Balance', type: 'currency', value: r => {
                        const total = parseFloat(r.amount) || 0;
                        const payments = LocalDB.getCollection('outstanding_payments').filter(p => String(p.outstandingId).trim() === String(r.id).trim());
                        const paid = payments.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);
                        return Math.max(0, total - paid);
                    }},
                    { key: 'date', label: 'Date', type: 'date' }
                ],
                totals: [
                    { key: 'amount', label: 'Total Amount' },
                    { label: 'Total Paid', reducer: rows => {
                        const allPayments = LocalDB.getCollection('outstanding_payments');
                        return allPayments.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);
                    }},
                    { label: 'Total Balance', reducer: rows => {
                        const totalAmt = rows.reduce((sum, r) => sum + (parseFloat(r.amount) || 0), 0);
                        const allPayments = LocalDB.getCollection('outstanding_payments');
                        const totalPaid = allPayments.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);
                        return Math.max(0, totalAmt - totalPaid);
                    }}
                ]
            },
            outstanding_payments: {
                columns: [
                    { key: 'outstandingId', label: 'Outstanding ID' },
                    { key: 'customer', label: 'Customer' },
                    { key: 'amount', label: 'Amount Paid', type: 'currency' },
                    { key: 'paidOn', label: 'Paid On', type: 'date' },
                    { key: 'paymentMethod', label: 'Payment Method' }
                ],
                totals: [{ key: 'amount', label: 'Total Payments' }]
            },
            payments: {
                columns: [
                    { key: 'invoiceNum', label: 'Invoice #' },
                    { key: 'customer', label: 'Company' },
                    { key: 'amount', label: 'Amount Paid', type: 'currency' },
                    { key: 'paidOn', label: 'Paid On', type: 'date' },
                    { key: 'paymentMethod', label: 'Payment Method' }
                ],
                totals: [{ key: 'amount', label: 'Total Payments' }]
            }
        };

        function formatDate(date) {
            if (!date) return 'N/A';
            const d = new Date(date);
            return d.toLocaleDateString();
        }

        function formatCurrency(amount) {
            return '$' + parseFloat(amount || 0).toFixed(2);
        }

        function showLoading(collection, isLoading) {
            const tableId = `${collection}-table`;
            const container = document.getElementById(tableId);
            if (!container) return;
            if (isLoading) {
                container.innerHTML = '<div class="loading"><div class="spinner"></div><span>Loading...</span></div>';
            }
        }

        // Tab Switching
        function switchTab(button, tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(b => b.classList.remove('active'));
            const tabEl = document.getElementById(`tab-${tabName}`);
            if (tabEl) tabEl.classList.add('active');
            if (button) button.classList.add('active');
            // Save current tab to localStorage
            try { localStorage.setItem('currentTab', tabName); }
            catch(e) { console.warn('Tab save error:', e); }
        }

        function bindTabClicks() {
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const tabName = btn.getAttribute('data-tab');
                    if (!tabName) return;
                    switchTab(btn, tabName);
                });
            });
        }

        // Database Helper
        async function addToCollection(collection, data) {
            // Generate a single ID and use it for both LocalDB and Firestore
            const id = LocalDB.addDoc(collection, data);
            try {
                const cloudData = mapWrite(collection, data);
                await db.collection(resolveColl(collection)).doc(id).set(cloudData);
            } catch (e) {
                console.warn('Firebase write error (using LocalDB fallback):', e);
                notify(`Cloud write failed for ${collection}: ${e.message || e}`, 'error');
            }
            loadCollection(collection);
        }

        async function updateInCollection(collection, id, data) {
            LocalDB.updateDoc(collection, id, data);
            try {
                const cloudData = mapWrite(collection, data);
                await db.collection(resolveColl(collection)).doc(id).set(cloudData, { merge: true });
            } catch (e) {
                console.warn('Firebase update error (updated locally):', e);
                notify(`Cloud update failed for ${collection}: ${e.message || e}`, 'error');
            }
            loadCollection(collection);
        }

        async function deleteFromCollection(collection, id) {
            LocalDB.deleteDoc(collection, id);
            try {
                await db.collection(resolveColl(collection)).doc(id).delete();
            } catch (e) {
                // Firebase permissions may be restricted - data is deleted locally, sync disabled
                if (e.code === 'permission-denied') {
                    console.warn('Firebase permission denied for delete - using local storage only');
                } else {
                    console.warn('Firebase delete error (removed locally):', e);
                    notify(`Cloud sync disabled for ${collection}`, 'warn');
                }
            }
            loadCollection(collection);
        }

        async function shareRecord(collection, id) {
            const data = LocalDB.getDoc(collection, id);
            if (!data) { notify('Record not found', 'error'); return; }
            
            try {
                notify('Generating PDF...', 'info');
                openPrintPreviewForRow(collection, id);
                await new Promise(resolve => setTimeout(resolve, 500));
                await shareFromOverlay();
            } catch (e) {
                console.error('Share error:', e);
                // Fallback to text share
                let shareText = '';
                if (collection === 'invoices') {
                    shareText = `Invoice #${data.num}\nCompany: ${data.customer}\nTotal Amount: ${formatCurrency(data.amount)}\nPaid: ${data.paid}\nAmount Paid: ${formatCurrency(data.amountPaid)}\nAmount Unpaid: ${formatCurrency(data.amountUnpaid)}\nDate: ${formatDate(data.date)}`;
                    
                    const payments = getInvoicePayments(data.num);
                    if (payments.length > 0) {
                        shareText += '\n\n--- Payment History ---';
                        payments.forEach(p => {
                            shareText += `\nDate: ${formatDate(p.paidOn)} | Amount: ${formatCurrency(p.amount)} | Method: ${p.paymentMethod}`;
                        });
                    }
                } else if (collection === 'expenses') {
                    shareText = `Expense\nCategory: ${data.category}\nAmount: ${formatCurrency(data.amount)}\nDescription: ${data.description}\nDate: ${formatDate(data.date)}`;
                } else if (collection === 'investments') {
                    shareText = `Investment\nInvestor: ${data.investor}\nAmount: ${formatCurrency(data.amount)}\nPaid To: ${data.paidTo}\nDate: ${formatDate(data.date)}\nMethod: ${data.method}`;
                } else {
                    shareText = JSON.stringify(data, null, 2);
                }
                
                if (navigator.share) {
                    navigator.share({
                        title: `${collection.charAt(0).toUpperCase() + collection.slice(1)} Record`,
                        text: shareText
                    }).catch(err => console.log('Share cancelled or failed:', err));
                } else {
                    navigator.clipboard.writeText(shareText).then(() => {
                        notify('Record copied to clipboard!', 'success');
                    }).catch(err => {
                        notify('Could not copy to clipboard', 'error');
                    });
                }
            }
        }

        function toggleCompanyGroup(company) {
            let currentState = false;
            try {
                currentState = sessionStorage.getItem(`expand_${company}`) !== 'false';
            } catch (e) {
                currentState = true;
            }
            try {
                sessionStorage.setItem(`expand_${company}`, !currentState);
            } catch (e) {
                console.warn('Session storage blocked:', e.message);
            }
            const invoices = RenderCache.invoices && RenderCache.invoices.length ? RenderCache.invoices : LocalDB.getCollection('invoices');
            renderTable('invoices', invoices);
        }

        function togglePaymentHistory(invoiceId) {
            const historyKey = `hist_${invoiceId}`;
            let isShown = false;
            try {
                isShown = sessionStorage.getItem(historyKey) === 'true';
            } catch (e) {
                isShown = false;
            }
            try {
                sessionStorage.setItem(historyKey, !isShown);
            } catch (e) {
                console.warn('Session storage blocked:', e.message);
            }
            // Re-render the invoices table to reflect history visibility
            const invoices = LocalDB.getCollection('invoices');
            renderTable('invoices', invoices);
        }

        function toggleOutstandingGroup(customer) {
            let currentState = false;
            try {
                currentState = sessionStorage.getItem(`expand_out_${customer}`) !== 'false';
            } catch (e) {
                currentState = true;
            }
            try {
                sessionStorage.setItem(`expand_out_${customer}`, !currentState);
            } catch (e) {
                console.warn('Session storage blocked:', e.message);
            }
            const outstanding = RenderCache.outstanding && RenderCache.outstanding.length ? RenderCache.outstanding : LocalDB.getCollection('outstanding');
            renderTable('outstanding', outstanding);
        }

        function toggleOutstandingHistory(outstandingId) {
            const historyKey = `out_hist_${outstandingId}`;
            let isShown = false;
            try {
                isShown = localStorage.getItem(historyKey) === 'true';
            } catch (e) {
                // Handle Tracking Prevention
                console.warn('Storage access blocked:', e.message);
                isShown = false;
            }
            try {
                localStorage.setItem(historyKey, !isShown);
            } catch (e) {
                console.warn('Storage access blocked:', e.message);
            }
            const outstanding = LocalDB.getCollection('outstanding');
            renderTable('outstanding', outstanding);
        }

        function expandAllInvoiceGroups() {
            const invoices = RenderCache.invoices && RenderCache.invoices.length ? RenderCache.invoices : LocalDB.getCollection('invoices');
            const grouped = {};
            invoices.forEach(row => {
                const company = row.customer || 'Unknown';
                if (!grouped[company]) grouped[company] = [];
                grouped[company].push(row);
            });
            Object.keys(grouped).forEach(company => {
                try {
                    sessionStorage.setItem(`expand_${company}`, 'true');
                } catch (e) {
                    console.warn('Session storage blocked:', e.message);
                }
            });
            renderTable('invoices', invoices);
        }

        function collapseAllInvoiceGroups() {
            const invoices = RenderCache.invoices && RenderCache.invoices.length ? RenderCache.invoices : LocalDB.getCollection('invoices');
            const grouped = {};
            invoices.forEach(row => {
                const company = row.customer || 'Unknown';
                if (!grouped[company]) grouped[company] = [];
                grouped[company].push(row);
            });
            Object.keys(grouped).forEach(company => {
                try {
                    sessionStorage.setItem(`expand_${company}`, 'false');
                } catch (e) {
                    console.warn('Session storage blocked:', e.message);
                }
            });
            renderTable('invoices', invoices);
        }

        function expandAllOutstandingGroups() {
            const outstanding = RenderCache.outstanding && RenderCache.outstanding.length ? RenderCache.outstanding : LocalDB.getCollection('outstanding');
            const grouped = {};
            outstanding.forEach(row => {
                const customer = row.customer || 'Unknown';
                if (!grouped[customer]) grouped[customer] = [];
                grouped[customer].push(row);
            });
            Object.keys(grouped).forEach(customer => {
                try {
                    sessionStorage.setItem(`expand_out_${customer}`, 'true');
                } catch (e) {
                    console.warn('Session storage blocked:', e.message);
                }
            });
            renderTable('outstanding', outstanding);
        }

        function collapseAllOutstandingGroups() {
            const outstanding = RenderCache.outstanding && RenderCache.outstanding.length ? RenderCache.outstanding : LocalDB.getCollection('outstanding');
            const grouped = {};
            outstanding.forEach(row => {
                const customer = row.customer || 'Unknown';
                if (!grouped[customer]) grouped[customer] = [];
                grouped[customer].push(row);
            });
            Object.keys(grouped).forEach(customer => {
                try {
                    sessionStorage.setItem(`expand_out_${customer}`, 'false');
                } catch (e) {
                    console.warn('Session storage blocked:', e.message);
                }
            });
            renderTable('outstanding', outstanding);
        }

        function openOutstandingEditModal(id) {
            const row = LocalDB.getDoc('outstanding', id);
            if (!row) return notify('Record not found', 'error');
            
            const modal = document.getElementById('edit-modal');
            modal.innerHTML = `
                <div class="modal-content" style="max-height:90vh;overflow-y:auto">
                    <div class="modal-header">
                        <h3>Record Outstanding Payment</h3>
                        <button class="modal-close" onclick="document.getElementById('edit-modal').classList.remove('active')">&times;</button>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Customer</label>
                        <div style="padding:8px;background:rgba(0,0,0,0.2);border-radius:4px">${row.customer}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Outstanding Amount</label>
                        <div style="padding:8px;background:rgba(0,0,0,0.2);border-radius:4px">${formatCurrency(row.amount)}</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Payment Amount</label>
                        <input type="number" id="out-pay-amount" class="input" placeholder="0.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Paid On</label>
                        <input type="date" id="out-pay-date" class="input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Payment Method</label>
                        <select id="out-pay-method" class="input">
                            <option>Cash</option>
                            <option>Bank Transfer</option>
                            <option>Check</option>
                            <option>Card</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary w-full" onclick="recordOutstandingPayment('${id}')">
                            <i class='fas fa-save mr-2'></i>Record Payment
                        </button>
                    </div>
                    <div style="margin-top:20px;border-top:1px solid rgba(59,130,246,0.2);padding-top:20px">
                        <h4 style="margin-bottom:12px">Payment History</h4>
                        <div id="out-payment-history-list" style="max-height:300px;overflow-y:auto"></div>
                    </div>
                </div>
            `;
            
            document.getElementById('out-pay-date').valueAsDate = new Date();
            displayOutstandingPaymentHistory(id);
            modal.classList.add('active');
        }

        function displayOutstandingPaymentHistory(outstandingId) {
            const payments = LocalDB.getCollection('outstanding_payments').filter(p => String(p.outstandingId).trim() === String(outstandingId).trim());
            const container = document.getElementById('out-payment-history-list');
            
            if (payments.length === 0) {
                container.innerHTML = '<p style="color:#9ca3af">No payments recorded yet</p>';
                return;
            }
            
            let html = '<table style="width:100%;border-collapse:collapse">';
            html += '<tr style="border-bottom:1px solid rgba(59,130,246,0.2)"><th style="padding:6px;text-align:left">Date</th><th style="padding:6px;text-align:left">Amount</th><th style="padding:6px;text-align:left">Method</th><th style="padding:6px">Action</th></tr>';
            payments.forEach(p => {
                html += `<tr style="border-bottom:1px solid rgba(59,130,246,0.1)"><td style="padding:6px">${formatDate(p.paidOn)}</td><td style="padding:6px">${p.amount}</td><td style="padding:6px">${p.paymentMethod}</td><td style="padding:6px"><button class="btn btn-danger toolbar-btn" onclick="deleteOutstandingPayment('${p.id}', '${outstandingId}')"><i class='fas fa-trash'></i></button></td></tr>`;
            });
            html += '</table>';
            container.innerHTML = html;
        }

        function recordOutstandingPayment(outstandingId) {
            const amount = document.getElementById('out-pay-amount').value;
            const paidOn = document.getElementById('out-pay-date').value;
            const method = document.getElementById('out-pay-method').value;
            
            if (!amount || parseFloat(amount) <= 0) return notify('Enter valid amount', 'error');
            if (!paidOn) return notify('Select paid on date', 'error');
            
            const outstanding = LocalDB.getDoc('outstanding', outstandingId);
            const paymentData = {
                outstandingId,
                customer: outstanding.customer,
                amount: parseFloat(amount),
                paidOn,
                paymentMethod: method
            };
            
            addToCollection('outstanding_payments', paymentData);
            displayOutstandingPaymentHistory(outstandingId);
            document.getElementById('out-pay-amount').value = '';
            notify('Payment recorded successfully!', 'success');
            
            // Auto-refresh outstanding table
            setTimeout(() => {
                const outstanding = LocalDB.getCollection('outstanding');
                renderTable('outstanding', outstanding);
            }, 200);
        }

        function deleteOutstandingPayment(paymentId, outstandingId) {
            if (!confirm('Delete this payment record?')) return;
            deleteFromCollection('outstanding_payments', paymentId);
            displayOutstandingPaymentHistory(outstandingId);
            notify('Payment deleted', 'success');
        }

        let paymentHistoryState = { invoiceId: null, invoiceNum: null };

        function openPaymentHistoryModal(invoiceId, invoiceNum) {
            paymentHistoryState = { invoiceId, invoiceNum };
            displayPaymentHistory();
            document.getElementById('payment-history-modal').classList.add('active');
            document.getElementById('payment-date').valueAsDate = new Date();
        }

        function closePaymentHistoryModal() {
            document.getElementById('payment-history-modal').classList.remove('active');
        }

        function displayPaymentHistory() {
            const payments = getInvoicePayments(paymentHistoryState.invoiceNum);
            let html = '<table style="width:100%;"><thead><tr><th>Date</th><th>Amount</th><th>Method</th><th>Action</th></tr></thead><tbody>';
            
            if (payments.length === 0) {
                html += '<tr><td colspan="4" style="text-align:center;padding:20px;">No payments recorded yet</td></tr>';
            } else {
                payments.forEach(p => {
                    html += `<tr>
                        <td>${formatDate(p.paidOn)}</td>
                        <td>${formatCurrency(p.amount)}</td>
                        <td>${p.paymentMethod}</td>
                        <td><button class="btn btn-danger toolbar-btn" onclick="deletePaymentRecord('${p.id}')"><i class='fas fa-trash'></i></button></td>
                    </tr>`;
                });
            }
            html += '</tbody></table>';
            document.getElementById('payment-history-content').innerHTML = html;
        }

        function recordPayment() {
            const amount = parseFloat(document.getElementById('payment-amount').value);
            const paidOn = document.getElementById('payment-date').value;
            const paymentMethod = document.getElementById('payment-method').value;
            
            if (!amount || !paidOn) {
                notify('Fill all payment fields', 'error');
                return;
            }
            
            const invoice = LocalDB.getDoc('invoices', paymentHistoryState.invoiceId);
            if (!invoice) {
                notify('Invoice not found', 'error');
                return;
            }
            
            // Create payment record
            const paymentRecord = {
                invoiceNum: paymentHistoryState.invoiceNum,
                invoiceId: paymentHistoryState.invoiceId,
                customer: invoice.customer,
                amount: amount,
                paidOn: paidOn,
                paymentMethod: paymentMethod
            };
            
            // Add to payments collection
            addToCollection('payments', paymentRecord);
            
            // Update invoice totals
            const currentPaid = parseFloat(invoice.amountPaid) || 0;
            const currentUnpaid = parseFloat(invoice.amountUnpaid) || 0;
            const newAmountPaid = currentPaid + amount;
            const newAmountUnpaid = Math.max(0, currentUnpaid - amount);
            
            updateInCollection('invoices', paymentHistoryState.invoiceId, {
                amountPaid: newAmountPaid,
                amountUnpaid: newAmountUnpaid,
                paid: (newAmountUnpaid <= 0) ? 'Full' : 'Partially'
            });
            
            // Reset form
            document.getElementById('payment-amount').value = '';
            document.getElementById('payment-method').value = 'cash';
            document.getElementById('payment-date').valueAsDate = new Date();
            
            displayPaymentHistory();
            notify('Payment recorded successfully!', 'success');
            loadCollection('invoices');
        }

        function deletePaymentRecord(paymentId) {
            if (confirm('Are you sure you want to delete this payment record?')) {
                const payment = LocalDB.getDoc('payments', paymentId);
                if (payment) {
                    deleteFromCollection('payments', paymentId);
                    
                    // Revert invoice amounts
                    const invoice = LocalDB.getDoc('invoices', payment.invoiceId);
                    if (invoice) {
                        const newAmountPaid = Math.max(0, parseFloat(invoice.amountPaid) - parseFloat(payment.amount));
                        const newAmountUnpaid = parseFloat(invoice.amountUnpaid) + parseFloat(payment.amount);
                        
                        updateInCollection('invoices', payment.invoiceId, {
                            amountPaid: newAmountPaid,
                            amountUnpaid: newAmountUnpaid,
                            paid: (newAmountUnpaid >= parseFloat(invoice.amount)) ? 'No' : (newAmountPaid <= 0 ? 'No' : 'Partially')
                        });
                    }
                }
                displayPaymentHistory();
                notify('Payment record deleted', 'success');
                loadCollection('invoices');
            }
        }

        async function loadCollection(collection) {
            // Firestore-first: try to read from cloud, then fall back to local
            showLoading(collection, true);
            try {
                // Try cache first, else iterate candidates until data found
                const candidates = [resolveColl(collection), ...(CloudNameCandidates[collection] || [])];
                const tried = new Set();
                let foundData = null;
                let foundName = null;
                for (const cname of candidates) {
                    if (!cname || tried.has(cname)) continue;
                    tried.add(cname);
                    try {
                        const snap = await db.collection(cname).get();
                        const data = [];
                        snap.forEach(doc => {
                            const raw = { id: doc.id, ...doc.data() };
                            const mapped = mapRead(collection, raw);
                            data.push(mapped);
                        });
                        if (data.length > 0) {
                            foundData = data;
                            foundName = cname;
                            break;
                        }
                    } catch (e) {
                        // continue trying next candidate
                    }
                }
                if (foundData) {
                    const cache = getCloudNameCache();
                    cache[collection] = foundName;
                    setCloudNameCache(cache);
                    LocalDB.saveCollection(collection, foundData);
                    renderTable(collection, foundData);
                    return;
                }
                // If cloud has no records, prefer existing local data
                const localData = LocalDB.getCollection(collection);
                renderTable(collection, localData);
                return;
            } catch (e) {
                console.warn('Firebase read error, falling back to local:', e);
                notify(`Cloud read failed for ${collection}: ${e.message || e}`, 'error');
            }

            try {
                const localData = LocalDB.getCollection(collection);
                renderTable(collection, localData);
            } catch (e) {
                console.warn('Local render error:', e);
            }
        }

        function updateTotals(collection, data) {
            const el = document.getElementById(`${collection}-totals`);
            if (!el) return;
            const schema = Schema[collection];
            if (!schema || !schema.totals) { el.textContent = ''; return; }
            const rows = Array.isArray(data) ? data : [];
            const parts = [];
            for (const t of schema.totals) {
                if (typeof t.reducer === 'function') {
                    const val = t.reducer(rows);
                    parts.push(`${t.label}: ${formatCurrency(val)}`);
                } else if (t.key) {
                    const filtered = t.filter ? rows.filter(t.filter) : rows;
                    const sum = filtered.reduce((s, r) => s + (parseFloat(r[t.key]) || 0), 0);
                    parts.push(`${t.label}: ${formatCurrency(sum)}`);
                }
            }
            el.textContent = parts.join('  ');
        }

        // Add Functions
        function addExpense() {
            const desc = document.getElementById('expense-desc').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const date = document.getElementById('expense-date').value;
            if (!desc || !amount) { notify('Fill all fields', 'error'); return; }
            addToCollection('expenses', { desc, amount, date: date || new Date().toISOString().split('T')[0] });
            document.getElementById('expense-desc').value = '';
            document.getElementById('expense-amount').value = '';
            notify('Expense added');
        }

        function addInvestment() {
            const name = document.getElementById('inv-name').value;
            const investor = document.getElementById('inv-investor') ? document.getElementById('inv-investor').value : '';
            const amount = parseFloat(document.getElementById('inv-amount').value);
            const paidTo = document.getElementById('inv-paid-to') ? document.getElementById('inv-paid-to').value : 'Shop';
            const date = document.getElementById('inv-date').value;
            const method = document.getElementById('inv-method') ? document.getElementById('inv-method').value : 'Cash';
            if (!name || !amount) { notify('Fill all fields', 'error'); return; }
            addToCollection('investments', { name, investor, amount, paidTo, date: date || new Date().toISOString().split('T')[0], method });
            document.getElementById('inv-name').value = '';
            document.getElementById('inv-amount').value = '';
            notify('Investment added');
        }

        function addSupplier() {
            const nameRaw = document.getElementById('supp-name').value;
            const name = normalizeName(nameRaw);
            const phone = document.getElementById('supp-phone') ? document.getElementById('supp-phone').value : '';
            const details = document.getElementById('supp-details') ? document.getElementById('supp-details').value : '';
            if (!name) { notify('Fill supplier name', 'error'); return; }
            addToCollection('suppliers', { name, phone, details });
            document.getElementById('supp-name').value = '';
            document.getElementById('supp-phone') && (document.getElementById('supp-phone').value = '');
            document.getElementById('supp-details') && (document.getElementById('supp-details').value = '');
            notify('Supplier added');
            refreshCompaniesDatalist();
        }

        function clearInvoiceForm() {
            const ids = ['inv-num', 'inv-customer', 'inv-invoice-date', 'inv-price', 'inv-amount-paid', 'inv-bsb', 'inv-account', 'inv-paid-on'];
            ids.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.value = '';
            });
            const invPaid = document.getElementById('inv-paid');
            if (invPaid) invPaid.value = 'No';
            const invPaymentMethod = document.getElementById('inv-payment-method');
            if (invPaymentMethod) invPaymentMethod.value = 'cash';
            const invPaidOnEl = document.getElementById('inv-paid-on');
            if (invPaidOnEl) invPaidOnEl.disabled = true;
            const invGstType = document.getElementById('inv-gst-type');
            if (invGstType) invGstType.value = 'include';
        }

        function addInvoice() {
            const num = document.getElementById('inv-num').value;
            const customerRaw = document.getElementById('inv-customer').value;
            const customer = normalizeName(customerRaw);
            const invoiceDate = document.getElementById('inv-invoice-date') ? document.getElementById('inv-invoice-date').value : '';
            const amount = parseFloat(document.getElementById('inv-price').value);
            const gstType = document.getElementById('inv-gst-type') ? document.getElementById('inv-gst-type').value : 'include';
            const gstRatePct = parseFloat(document.getElementById('gst-rate')?.value || '10');
            const paid = document.getElementById('inv-paid') ? document.getElementById('inv-paid').value : 'No';
            const customAmountPaid = document.getElementById('inv-amount-paid') ? parseFloat(document.getElementById('inv-amount-paid').value) : null;
            const paidOn = document.getElementById('inv-paid-on') ? document.getElementById('inv-paid-on').value : '';
            const paymentMethod = document.getElementById('inv-payment-method') ? document.getElementById('inv-payment-method').value : 'cash';
            const bsb = document.getElementById('inv-bsb') ? document.getElementById('inv-bsb').value : '';
            const account = document.getElementById('inv-account') ? document.getElementById('inv-account').value : '';
            if (!num || !customer || !amount) { notify('Fill all fields', 'error'); return; }
            const existingInvoices = LocalDB.getCollection('invoices');
            const normalizedNum = String(num).trim().toLowerCase();
            if (existingInvoices.some(r => String(r.num).trim().toLowerCase() === normalizedNum)) {
                notify('Invoice is already registered', 'error');
                clearInvoiceForm();
                return;
            }
            const matchingInvoices = existingInvoices.filter(r => normalizeName(r.customer) === customer);
            let resolvedBsb = bsb;
            let resolvedAccount = account;
            if ((!resolvedBsb || !resolvedAccount) && matchingInvoices.length) {
                const matchWithBank = matchingInvoices.find(r => (r.bsb || r.account));
                if (matchWithBank) {
                    if (!resolvedBsb) resolvedBsb = matchWithBank.bsb || '';
                    if (!resolvedAccount) resolvedAccount = matchWithBank.account || '';
                }
            }
            // Derive cloud-aligned fields
            let netAmount, gstAmount, totalAmount;
            const rate = (isNaN(gstRatePct) ? 10 : gstRatePct) / 100;
            if (gstType === 'include') {
                netAmount = amount / (1 + rate);
                gstAmount = amount - netAmount;
                totalAmount = amount;
            } else {
                netAmount = amount;
                gstAmount = amount * rate;
                totalAmount = netAmount + gstAmount;
            }
            const status = (paid !== 'No') ? 'paid' : 'unpaid';
            let amountPaid, amountUnpaid;
            if (customAmountPaid !== null && !isNaN(customAmountPaid)) {
                amountPaid = customAmountPaid;
                amountUnpaid = totalAmount - customAmountPaid;
            } else if (paid === 'Full') {
                amountPaid = totalAmount;
                amountUnpaid = Math.max(0, totalAmount - totalAmount);
            } else if (paid === 'Half') {
                amountPaid = totalAmount / 2;
                amountUnpaid = Math.max(0, totalAmount - amountPaid);
            } else if (paid === 'Partially') {
                amountPaid = totalAmount * 0.3; // 30% as default partial
                amountUnpaid = Math.max(0, totalAmount - amountPaid);
            } else {
                amountPaid = 0;
                amountUnpaid = Math.max(0, totalAmount - amountPaid);
            }
            addToCollection('invoices', { num, customer, amount: totalAmount, date: invoiceDate || new Date().toISOString().split('T')[0], paid, paidOn, paymentMethod, bsb: resolvedBsb, account: resolvedAccount, status, gstType, gstRate: isNaN(gstRatePct) ? 10 : gstRatePct, netAmount, gstAmount, amountPaid, amountUnpaid });
            if (resolvedBsb || resolvedAccount) {
                matchingInvoices.forEach(inv => {
                    const needsUpdate = (resolvedBsb && inv.bsb !== resolvedBsb) || (resolvedAccount && inv.account !== resolvedAccount);
                    if (needsUpdate) {
                        updateInCollection('invoices', inv.id, {
                            bsb: resolvedBsb || inv.bsb || '',
                            account: resolvedAccount || inv.account || ''
                        });
                    }
                });
            }
            clearInvoiceForm();
            notify('Invoice added');
            refreshCompaniesDatalist();
        }

        function addExchange() {
            const amount = parseFloat(document.getElementById('exc-amount').value);
            const service = document.getElementById('exc-service') ? document.getElementById('exc-service').value : '';
            const cashType = document.getElementById('exc-type') ? document.getElementById('exc-type').value : 'in';
            const status = document.getElementById('exc-status') ? document.getElementById('exc-status').value : 'Pending';
            const paidOn = document.getElementById('exc-paid-on') ? document.getElementById('exc-paid-on').value : '';
            if (!amount) { notify('Enter amount', 'error'); return; }
            addToCollection('exchange', { amount, service, cashType, status, paidOn });
            document.getElementById('exc-amount').value = '';
            notify('Exchange record added');
        }

        function addCash() {
            const desc = document.getElementById('cash-desc').value;
            const type = document.getElementById('cash-type').value;
            const amount = parseFloat(document.getElementById('cash-amount').value);
            if (!desc || !amount) { notify('Fill all fields', 'error'); return; }
            addToCollection('cash', { desc, type, amount, date: new Date().toISOString().split('T')[0] });
            document.getElementById('cash-desc').value = '';
            document.getElementById('cash-amount').value = '';
            notify('Cash record added');
        }

        function addOutstanding() {
            const customer = document.getElementById('out-customer').value;
            const amount = parseFloat(document.getElementById('out-amount').value);
            const date = document.getElementById('out-date').value;
            if (!customer || !amount) { notify('Fill all fields', 'error'); return; }
            addToCollection('outstanding', { customer, amount, date: date || new Date().toISOString().split('T')[0] });
            document.getElementById('out-customer').value = '';
            document.getElementById('out-amount').value = '';
            notify('Outstanding added');
        }

        // Setup invoice form auto-lock and auto-fill
        function setupFirstLetterAutocomplete(inputId, datalistId) {
            const input = document.getElementById(inputId);
            const datalist = document.getElementById(datalistId);
            if (!input || !datalist) return;
            
            input.addEventListener('input', (e) => {
                const query = normalizeKey(e.target.value);
                const options = Array.from(datalist.querySelectorAll('option')).map(o => o.value);
                if (!query) {
                    input.blur();
                    input.focus();
                    return;
                }
                const firstChar = query.charAt(0);
                const match = options.find(opt => normalizeKey(opt).charAt(0) === firstChar);
                if (match && !options.includes(input.value)) {
                    const remaining = match.slice(input.value.length);
                    input.value = match;
                    input.setSelectionRange(input.value.length - remaining.length, input.value.length);
                }
            });
        }
        
        function setupInvoiceFormListeners() {
            const customerInput = document.getElementById('inv-customer');
            if (!customerInput) return;
            
            // Enable first-letter autocomplete
            setupFirstLetterAutocomplete('inv-customer', 'companies-list');
            
            customerInput.addEventListener('change', () => {
                const normalized = normalizeName(customerInput.value);
                const invBsb = document.getElementById('inv-bsb');
                const invAccount = document.getElementById('inv-account');
                const invPaidOn = document.getElementById('inv-paid-on');
                if (!normalized || !invBsb || !invAccount) return;
                const existing = LocalDB.getCollection('invoices').find(r => normalizeName(r.customer) === normalized && (r.bsb || r.account));
                if (existing) {
                    if (!invBsb.value) invBsb.value = existing.bsb || '';
                    if (!invAccount.value) invAccount.value = existing.account || '';
                }
                if (invPaidOn) invPaidOn.disabled = false;
            });
            
            // Enable/disable Paid On based on paid status
            const invPaidSel = document.getElementById('inv-paid');
            const invPaidOn = document.getElementById('inv-paid-on');
            if (invPaidSel && invPaidOn) {
                invPaidSel.addEventListener('change', () => {
                    if (invPaidSel.value === 'Full' || invPaidSel.value === 'Partially' || invPaidSel.value === 'Half') {
                        invPaidOn.disabled = false;
                        if (!invPaidOn.value) invPaidOn.valueAsDate = new Date();
                    } else {
                        invPaidOn.value = '';
                        invPaidOn.disabled = true;
                    }
                });
            }
        }
        
        function renderTable(collection, data) {
            const tableId = `${collection}-table`;
            const container = document.getElementById(tableId);
            if (!container) return;

            if (Object.prototype.hasOwnProperty.call(RenderCache, collection)) {
                RenderCache[collection] = Array.isArray(data) ? data : [];
            }

            try {
                if (!Array.isArray(data) || data.length === 0) {
                    container.innerHTML = '<p class="text-gray-400">No records yet</p>';
                    updateTotals(collection, []);
                    return;
                }

                const schema = Schema[collection];
                const cols = (schema && schema.columns) ? schema.columns : Object.keys(data[0] || {}).filter(k => k !== 'id' && k !== 'createdAt').map(k => ({ key: k, label: k }));
                
                // Special grouping for invoices by company
                if (collection === 'invoices') {
                    let html = '';
                    
                    // Group invoices by company
                    const grouped = {};
                    data.forEach(row => {
                        const company = row.customer || 'Unknown';
                        if (!grouped[company]) grouped[company] = [];
                        grouped[company].push(row);
                    });
                    
                    // Sort companies alphabetically
                    const sortedCompanies = Object.keys(grouped).sort((a, b) => a.localeCompare(b));
                    
                    // Build grouped table
                    sortedCompanies.forEach((company, idx) => {
                        const rows = grouped[company];
                        const totalAmount = rows.reduce((sum, r) => sum + (parseFloat(r.amount) || 0), 0);
                        const totalBalance = rows.reduce((sum, r) => sum + getInvoiceBalance(r), 0);
                        
                        let isOpen = true;
                        try {
                            isOpen = sessionStorage.getItem(`expand_${company}`) !== 'false';
                        } catch (e) {
                            isOpen = true; // Default expanded
                        }
                        html += `<div style="margin-bottom:15px;border:1px solid #3b82f6;border-radius:6px;overflow:hidden">`;
                        html += `<div style="background:#1e3a8a;padding:12px;cursor:pointer;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:8px" onclick="toggleCompanyGroup('${company}')">
                            <div style="display:flex;align-items:center;gap:10px;min-width:200px">
                                <span style="color:#3b82f6;font-weight:bold">${isOpen ? '' : ''}</span>
                                <span style="color:white;font-weight:600;word-break:break-word">${company}</span>
                                <span style="color:#cbd5e1;font-size:12px;white-space:nowrap">(${rows.length})</span>
                            </div>
                            <div style="color:#3b82f6;font-size:11px;text-align:right;flex:1;min-width:180px">
                                <div style="margin-top:4px">Total Amount: ${formatCurrency(totalAmount)}</div>
                                <div>Bal: ${formatCurrency(totalBalance)}</div>
                            </div>
                        </div>`;
                        
                        if (isOpen) {
                            html += '<div style="overflow-x:auto;-webkit-overflow-scrolling:touch"><table style="width:100%;border-collapse:collapse;min-width:600px">';
                            html += '<thead><tr style="background:#0f172a">';
                            cols.forEach(c => { html += `<th style="padding:8px;border-bottom:1px solid #3b82f6;word-break:break-word">${c.label}</th>`; });
                            html += '<th style="padding:8px;border-bottom:1px solid #3b82f6">Actions</th></tr></thead><tbody>';
                            
                            rows.forEach(row => {
                                const payments = getInvoicePayments(row.num);
                                const invoiceAmount = parseFloat(row.amount) || 0;
                                const historyKey = `hist_${row.id}`;
                                let showHistory = false;
                                try {
                                    showHistory = sessionStorage.getItem(historyKey) === 'true';
                                } catch (e) {
                                    showHistory = false;
                                }
                                
                                html += '<tr style="border-bottom:1px solid #1e293b">';
                                cols.forEach(c => {
                                    let val = (typeof c.value === 'function') ? c.value(row) : row[c.key];
                                    if (c.type === 'currency') val = formatCurrency(val);
                                    else if (c.type === 'date') val = formatDate(val);
                                    html += `<td style="padding:8px">${(val ?? 'N/A')}</td>`;
                                });
                                const id = row.id || '';
                                html += `<td style="padding:8px"><div class="action-buttons">
                                    <button class="btn btn-primary toolbar-btn no-print" onclick="togglePaymentHistory('${id}')" title="History"><i class='fas fa-history'></i></button>
                                    <button class="btn btn-primary toolbar-btn no-print" onclick="openEditModal('${collection}', '${id}')" title="Edit"><i class='fas fa-pen'></i></button>
                                    <button class="btn btn-primary toolbar-btn no-print" onclick="shareRecord('${collection}', '${id}')" title="Share"><i class='fas fa-share-alt'></i></button>
                                    <button class="btn btn-danger toolbar-btn no-print" onclick="deleteFromCollection('${collection}', '${id}')" title="Delete"><i class='fas fa-trash'></i></button>
                                    <button class="btn btn-primary toolbar-btn no-print" onclick="openPrintPreviewForRow('${collection}', '${id}')" title="Preview"><i class='fas fa-eye'></i></button>
                                    <button class="btn btn-primary toolbar-btn no-print" onclick="printRow('${collection}', '${id}')" title="Print"><i class='fas fa-print'></i></button>
                                </div></td>`;
                                html += '</tr>';
                                
                                // Payment History Row
                                if (showHistory && payments.length > 0) {
                                    const totalPaid = payments.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);
                                    const remaining = Math.max(0, invoiceAmount - totalPaid);
                                                const payments = getInvoicePayments(paymentHistoryState.invoiceNum);
                                                        const payments = getInvoicePayments(data.num);
                                    html += `<tr style="background:#0f172a;border-bottom:1px solid #1e293b">
                                        <td colspan="${cols.length + 1}" style="padding:12px">
                                            <div style="color:#cbd5e1;font-size:13px">
                                                <div style="margin-bottom:8px;font-weight:600;color:#3b82f6">Payment History - Invoice #${row.num} (${row.customer})</div>
                                                <table style="width:100%;margin-bottom:8px">
                                                    <thead>
                                                        <tr style="border-bottom:1px solid #3b82f6">
                                                            <th style="padding:6px;text-align:left">Date</th>
                                                            <th style="padding:6px;text-align:left">Amount</th>
                                                            <th style="padding:6px;text-align:left">Method</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${payments.map(p => `
                                                            <tr style="border-bottom:1px solid #1e293b">
                                                                <td style="padding:6px">${formatDate(p.paidOn) || 'N/A'}</td>
                                                                <td style="padding:6px">${p.amount}</td>
                                                                <td style="padding:6px">${p.paymentMethod || 'N/A'}</td>
                                                            </tr>
                                                        `).join('')}
                                                    </tbody>
                                                </table>
                                                <div style="display:flex;gap:20px;padding-top:8px;border-top:1px solid #3b82f6">
                                                    <div>Invoice Amount: <span style="color:#3b82f6;font-weight:600">${formatCurrency(invoiceAmount)}</span></div>
                                                    <div>Total Paid: <span style="color:#10b981;font-weight:600">${formatCurrency(totalPaid)}</span></div>
                                                    <div>Remaining: <span style="color:#${remaining > 0 ? 'ef4444' : '10b981'};font-weight:600">${formatCurrency(remaining)}</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>`;
                                }
                            });
                            html += '</tbody></table></div>';
                        }
                        html += '</div>';
                    });
                    
                    container.innerHTML = html;
                    updateTotals(collection, data);
                    return;
                }
                
                // Special grouping for outstanding by customer
                if (collection === 'outstanding') {
                    let html = '';
                    
                    // Group outstanding by customer
                    const grouped = {};
                    data.forEach(row => {
                        const customer = row.customer || 'Unknown';
                        if (!grouped[customer]) grouped[customer] = [];
                        grouped[customer].push(row);
                    });
                    
                    // Sort customers alphabetically
                    const sortedCustomers = Object.keys(grouped).sort((a, b) => a.localeCompare(b));
                    
                    // Build grouped table
                    sortedCustomers.forEach((customer, idx) => {
                        const rows = grouped[customer];
                        const totalAmount = rows.reduce((sum, r) => sum + (parseFloat(r.amount) || 0), 0);
                        const totalBalance = rows.reduce((sum, r) => {
                            const payments = LocalDB.getCollection('outstanding_payments').filter(p => String(p.outstandingId).trim() === String(r.id).trim());
                            const paid = payments.reduce((s, p) => s + (parseFloat(p.amount) || 0), 0);
                            return sum + Math.max(0, parseFloat(r.amount) - paid || 0);
                        }, 0);
                        
                        let isOpen = true;
                        try {
                            isOpen = sessionStorage.getItem(`expand_out_${customer}`) !== 'false';
                        } catch (e) {
                            isOpen = true; // Default expanded
                        }
                        html += `<div style="margin-bottom:15px;border:1px solid #3b82f6;border-radius:6px;overflow:hidden">`;
                        html += `<div style="background:#1e3a8a;padding:12px;cursor:pointer;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:8px" onclick="toggleOutstandingGroup('${customer}')">
                            <div style="display:flex;align-items:center;gap:10px;min-width:200px">
                                <span style="color:#3b82f6;font-weight:bold">${isOpen ? '' : ''}</span>
                                <span style="color:white;font-weight:600;word-break:break-word">${customer}</span>
                                <span style="color:#cbd5e1;font-size:12px;white-space:nowrap">(${rows.length})</span>
                            </div>
                            <div style="color:#3b82f6;font-size:11px;text-align:right;flex:1;min-width:180px">
                                <div style="margin-top:4px">Total Amount: ${formatCurrency(totalAmount)}</div>
                                <div>Bal: ${formatCurrency(totalBalance)}</div>
                            </div>
                        </div>`;
                        
                        if (isOpen) {
                            html += '<div style="overflow-x:auto;-webkit-overflow-scrolling:touch"><table style="width:100%;border-collapse:collapse;min-width:600px">';
                            html += '<thead><tr style="background:#0f172a">';
                            cols.forEach(c => { html += `<th style="padding:8px;border-bottom:1px solid #3b82f6;word-break:break-word">${c.label}</th>`; });
                            html += '<th style="padding:8px;border-bottom:1px solid #3b82f6">Actions</th></tr></thead><tbody>';
                            
                            rows.forEach(row => {
                                const payments = LocalDB.getCollection('outstanding_payments').filter(p => String(p.outstandingId).trim() === String(row.id).trim());
                                const outstandingAmount = parseFloat(row.amount) || 0;
                                const historyKey = `out_hist_${row.id}`;
                                let showHistory = false;
                                try {
                                    showHistory = localStorage.getItem(historyKey) === 'true';
                                } catch (e) {
                                    showHistory = false;
                                }
                                
                                html += '<tr style="border-bottom:1px solid #1e293b">';
                                cols.forEach(c => {
                                    let val = (typeof c.value === 'function') ? c.value(row) : row[c.key];
                                    if (c.type === 'currency') val = formatCurrency(val);
                                    else if (c.type === 'date') val = formatDate(val);
                                    html += `<td style="padding:8px">${(val ?? 'N/A')}</td>`;
                                });
                                const id = row.id || '';
                                html += `<td style="padding:8px"><div class="action-buttons">
                                    <button class="btn btn-primary toolbar-btn no-print" onclick="toggleOutstandingHistory('${id}')" title="History"><i class='fas fa-history'></i></button>
                                    <button class="btn btn-primary toolbar-btn no-print" onclick="openOutstandingEditModal('${id}')" title="Edit"><i class='fas fa-pen'></i></button>
                                    <button class="btn btn-primary toolbar-btn no-print" onclick="shareRecord('${collection}', '${id}')" title="Share"><i class='fas fa-share-alt'></i></button>
                                    <button class="btn btn-danger toolbar-btn no-print" onclick="deleteFromCollection('${collection}', '${id}')" title="Delete"><i class='fas fa-trash'></i></button>
                                    <button class="btn btn-primary toolbar-btn no-print" onclick="openPrintPreviewForRow('${collection}', '${id}')" title="Preview"><i class='fas fa-eye'></i></button>
                                    <button class="btn btn-primary toolbar-btn no-print" onclick="printRow('${collection}', '${id}')" title="Print"><i class='fas fa-print'></i></button>
                                </div></td>`;
                                html += '</tr>';
                                
                                // Payment History Row
                                if (showHistory) {
                                    const totalPaid = payments.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);
                                    const remaining = Math.max(0, outstandingAmount - totalPaid);
                                    html += `<tr style="background:#0f172a;border-bottom:1px solid #1e293b">
                                        <td colspan="${cols.length + 1}" style="padding:12px">
                                            <div style="color:#cbd5e1;font-size:13px;max-height:400px;overflow-y:auto">
                                                <div style="margin-bottom:8px;font-weight:600;color:#3b82f6">Payment History - ${row.customer}</div>
                                                <table style="width:100%;margin-bottom:8px">
                                                    <thead>
                                                        <tr style="border-bottom:1px solid #3b82f6">
                                                            <th style="padding:6px;text-align:left">Paid On</th>
                                                            <th style="padding:6px;text-align:left">Amount</th>
                                                            <th style="padding:6px;text-align:left">Method</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${payments.map(p => `
                                                            <tr style="border-bottom:1px solid #1e293b">
                                                                <td style="padding:6px">${formatDate(p.paidOn) || 'N/A'}</td>
                                                                <td style="padding:6px">${p.amount}</td>
                                                                <td style="padding:6px">${p.paymentMethod || 'N/A'}</td>
                                                            </tr>
                                                        `).join('')}
                                                    </tbody>
                                                </table>
                                                <div style="display:flex;gap:20px;padding-top:8px;border-top:1px solid #3b82f6;flex-wrap:wrap">
                                                    <div>Outstanding Amount: <span style="color:#3b82f6;font-weight:600">${formatCurrency(outstandingAmount)}</span></div>
                                                    <div>Total Paid: <span style="color:#10b981;font-weight:600">${formatCurrency(totalPaid)}</span></div>
                                                    <div>Remaining: <span style="color:#${remaining > 0 ? 'ef4444' : '10b981'};font-weight:600">${formatCurrency(remaining)}</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>`;
                                }
                            });
                            html += '</tbody></table></div>';
                        }
                        html += '</div>';
                    });
                    
                    container.innerHTML = html;
                    updateTotals(collection, data);
                    return;
                }
                
                // Default table rendering for other collections
                let html = '<div style="overflow-x:auto;-webkit-overflow-scrolling:touch"><table style="min-width:600px;width:100%">';
                html += '<thead><tr>';
                cols.forEach(c => { html += `<th>${c.label}</th>`; });
                html += '<th>Actions</th></tr></thead><tbody>';

                data.forEach(row => {
                    html += '<tr>';
                    cols.forEach(c => {
                        let val = (typeof c.value === 'function') ? c.value(row) : row[c.key];
                        if (c.type === 'currency') val = formatCurrency(val);
                        else if (c.type === 'date') val = formatDate(val);
                        html += `<td>${(val ?? 'N/A')}</td>`;
                    });
                    const id = row.id || '';
                    html += `<td class="flex gap-2">
                        <button class="btn btn-primary toolbar-btn no-print" onclick="openEditModal('${collection}', '${id}')"><i class='fas fa-pen'></i></button>
                        <button class="btn btn-primary toolbar-btn no-print" onclick="shareRecord('${collection}', '${id}')"><i class='fas fa-share-alt'></i></button>
                        <button class="btn btn-danger toolbar-btn no-print" onclick="deleteFromCollection('${collection}', '${id}')"><i class='fas fa-trash'></i></button>
                        <button class="btn btn-primary toolbar-btn no-print" onclick="openPrintPreviewForRow('${collection}', '${id}')"><i class='fas fa-eye'></i></button>
                        <button class="btn btn-primary toolbar-btn no-print" onclick="printRow('${collection}', '${id}')"><i class='fas fa-print'></i></button>
                    </td>`;
                    html += '</tr>';
                });
                html += '</tbody></table></div>';
                container.innerHTML = html;
                updateTotals(collection, data);
            } catch (e) {
                console.error('renderTable error:', e);
                container.innerHTML = '<p class="text-red-400">Error rendering table</p>';
            }
        }

        function renderTableToContainer(collection, data, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            let html = '';
            if (!Array.isArray(data) || data.length === 0) {
                container.innerHTML = '<p class="text-gray-400">No records yet</p>';
                return;
            }
            const schema = Schema[collection];
            let cols = (schema && schema.columns) ? schema.columns : Object.keys(data[0] || {}).filter(k => k !== 'id' && k !== 'createdAt').map(k => ({ key: k, label: k }));
            
            // Filter columns based on investor data for investments
            if (collection === 'investments' && containerId === 'investments-hayat-table') {
                cols = cols.filter(c => c.label !== 'Abbas');
            } else if (collection === 'investments' && containerId === 'investments-abbas-table') {
                cols = cols.filter(c => c.label !== 'Haji Hayat');
            }
            
            html += '<table><thead><tr>' + cols.map(c => `<th>${c.label}</th>`).join('') + '<th>Actions</th></tr></thead><tbody>';
            data.forEach(row => {
                html += '<tr>';
                cols.forEach(c => {
                    let val = (typeof c.value === 'function') ? c.value(row) : row[c.key];
                    if (c.type === 'currency') val = formatCurrency(val);
                    else if (c.type === 'date') val = formatDate(val);
                    html += `<td>${(val ?? 'N/A')}</td>`;
                });
                const id = row.id || '';
                html += `<td class="flex gap-2">
                    <button class="btn btn-primary toolbar-btn no-print" onclick="openEditModal('${collection}', '${id}')"><i class='fas fa-pen'></i></button>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="shareRecord('${collection}', '${id}')"><i class='fas fa-share-alt'></i></button>
                    <button class="btn btn-danger toolbar-btn no-print" onclick="deleteFromCollection('${collection}', '${id}')"><i class='fas fa-trash'></i></button>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="openPrintPreviewForRow('${collection}', '${id}')"><i class='fas fa-eye'></i></button>
                    <button class="btn btn-primary toolbar-btn no-print" onclick="printRow('${collection}', '${id}')"><i class='fas fa-print'></i></button>
                </td>`;
                html += '</tr>';
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function refreshInvestmentsSplit() {
            const rows = LocalDB.getCollection('investments');
            const hayat = rows.filter(r => r.investor === 'Haji Hayat');
            const abbas = rows.filter(r => r.investor === 'Abbas');
            renderTableToContainer('investments', hayat, 'investments-hayat-table');
            renderTableToContainer('investments', abbas, 'investments-abbas-table');
            updateInvestorTotal('hayat', hayat);
            updateInvestorTotal('abbas', abbas);
        }

        function switchInvTab(tab) {
            // Hide all
            document.getElementById('inv-all').style.display = 'none';
            document.getElementById('inv-hayat').style.display = 'none';
            document.getElementById('inv-abbas').style.display = 'none';
            // Reset buttons
            document.getElementById('tab-btn-all').classList.remove('active');
            document.getElementById('tab-btn-hayat').classList.remove('active');
            document.getElementById('tab-btn-abbas').classList.remove('active');
            // Save investment subtab selection
            try { localStorage.setItem('currentInvTab', tab); }
            catch(e) { console.warn('Investment tab save error:', e); }
            // Show selected
            if (tab === 'all') {
                document.getElementById('inv-all').style.display = 'block';
                document.getElementById('tab-btn-all').classList.add('active');
                loadCollection('investments');
            } else if (tab === 'hayat') {
                document.getElementById('inv-hayat').style.display = 'block';
                document.getElementById('tab-btn-hayat').classList.add('active');
                loadInvestorFromFirebase('Haji Hayat');
            } else if (tab === 'abbas') {
                document.getElementById('inv-abbas').style.display = 'block';
                document.getElementById('tab-btn-abbas').classList.add('active');
                loadInvestorFromFirebase('Abbas');
            }
        }

        async function loadInvestorFromFirebase(investor) {
            showLoading('investments', true);
            try {
                // Fetch from Firebase
                const snapshot = await db.collection('investments').where('investor', '==', investor).get();
                const firebaseData = [];
                snapshot.forEach(doc => {
                    const raw = { id: doc.id, ...doc.data() };
                    const mapped = mapRead('investments', raw);
                    firebaseData.push(mapped);
                });
                
                // Merge with local data
                const localRows = LocalDB.getCollection('investments').filter(r => r.investor === investor);
                const combined = [...firebaseData];
                localRows.forEach(local => {
                    if (!combined.find(f => f.id === local.id)) {
                        combined.push(local);
                    }
                });
                
                // Ensure all required fields exist
                const requiredFields = ['name', 'investor', 'amount', 'paidTo', 'date', 'method'];
                const processed = combined.map(r => {
                    requiredFields.forEach(field => {
                        if (!(field in r)) {
                            r[field] = field === 'amount' ? 0 : field === 'paidTo' ? 'Shop' : field === 'method' ? 'Cash' : '';
                        }
                    });
                    return r;
                });
                
                if (investor === 'Haji Hayat') {
                    renderTableToContainer('investments', processed, 'investments-hayat-table');
                    updateInvestorTotal('hayat', processed);
                } else {
                    renderTableToContainer('investments', processed, 'investments-abbas-table');
                    updateInvestorTotal('abbas', processed);
                }
                notify(`Loaded ${processed.length} ${investor} records from Firebase`, 'success');
            } catch (e) {
                console.warn('Firebase load error:', e);
                // Fallback to local data
                const localRows = LocalDB.getCollection('investments').filter(r => r.investor === investor);
                if (investor === 'Haji Hayat') {
                    renderTableToContainer('investments', localRows, 'investments-hayat-table');
                    updateInvestorTotal('hayat', localRows);
                } else {
                    renderTableToContainer('investments', localRows, 'investments-abbas-table');
                    updateInvestorTotal('abbas', localRows);
                }
                notify('Loaded from local storage', 'success');
            }
            showLoading('investments', false);
        }

        function updateInvestorTotal(investor, data) {
            const total = data.reduce((sum, row) => sum + (parseFloat(row.amount) || 0), 0);
            const name = investor === 'hayat' ? 'Haji Hayat' : 'Abbas';
            const el = document.getElementById(`inv-${investor}-totals`);
            if (el) el.textContent = `${name} Total: ${formatCurrency(total)}`;
        }

        function printInvestorTab(investor) {
            const rows = LocalDB.getCollection('investments');
            const name = investor === 'hayat' ? 'Haji Hayat' : 'Abbas';
            const filtered = rows.filter(r => r.investor === name);
            const schema = Schema.investments;
            const cols = schema.columns;
            let html = buildPrintHeader(`${name} - Investments`);
            html += '<table style="width:100%;border-collapse:collapse"><thead><tr>';
            cols.forEach(c => html += `<th style="border-bottom:1px solid #ccc;padding:8px;text-align:left">${c.label}</th>`);
            html += '</tr></thead><tbody>';
            filtered.forEach(r => {
                html += '<tr>';
                cols.forEach(c => {
                    let val = (typeof c.value === 'function') ? c.value(r) : r[c.key];
                    if (c.type === 'currency') val = formatCurrency(val);
                    else if (c.type === 'date') val = formatDate(val);
                    html += `<td style="padding:8px;border-bottom:1px solid #eee">${val ?? ''}</td>`;
                });
                html += '</tr>';
            });
            const total = filtered.reduce((sum, row) => sum + (parseFloat(row.amount) || 0), 0);
            html += `<tr><td colspan="${cols.length - 1}" style="text-align:right;font-weight:bold;padding:8px">Total:</td><td style="font-weight:bold;padding:8px">${formatCurrency(total)}</td></tr>`;
            html += '</tbody></table>';
            const win = window.open('', '_blank');
            if (!win) return notify('Popup blocked', 'error');
            win.document.write(`<html><head><title>${name}</title><style>body{padding:20px;font-family:Arial}</style></head><body><div style="margin-bottom:10px"><button onclick="window.print()">Print</button> <button onclick="window.close()">Close</button></div>${html}</body></html>`);
            win.document.close();
        }

        function exportInvestmentsPDF(type) {
            const rows = LocalDB.getCollection('investments');
            let filtered, title;
            if (type === 'hayat') {
                filtered = rows.filter(r => r.investor === 'Haji Hayat');
                title = 'Haji Hayat Investments';
            } else if (type === 'abbas') {
                filtered = rows.filter(r => r.investor === 'Abbas');
                title = 'Abbas Investments';
            } else {
                filtered = rows;
                title = 'All Investments';
            }
            const schema = Schema.investments;
            const cols = schema.columns;
            let html = buildPrintHeader(title);
            html += '<table style="width:100%;border-collapse:collapse"><thead><tr>';
            cols.forEach(c => html += `<th style="border-bottom:1px solid #ccc;padding:8px;text-align:left">${c.label}</th>`);
            html += '</tr></thead><tbody>';
            filtered.forEach(r => {
                html += '<tr>';
                cols.forEach(c => {
                    let val = (typeof c.value === 'function') ? c.value(r) : r[c.key];
                    if (c.type === 'currency') val = formatCurrency(val);
                    else if (c.type === 'date') val = formatDate(val);
                    html += `<td style="padding:8px;border-bottom:1px solid #eee">${val ?? ''}</td>`;
                });
                html += '</tr>';
            });
            const total = filtered.reduce((sum, row) => sum + (parseFloat(row.amount) || 0), 0);
            html += `<tr><td colspan="${cols.length - 1}" style="text-align:right;font-weight:bold;padding:8px">Total:</td><td style="font-weight:bold;padding:8px">${formatCurrency(total)}</td></tr>`;
            html += '</tbody></table>';
            const win = window.open('', '_blank');
            if (!win) return notify('Popup blocked', 'error');
            win.document.write(`<html><head><title>${title}</title><style>body{padding:20px;font-family:Arial}@media print{.btn{display:none}}</style></head><body><div style="margin-bottom:10px"><button class="btn" onclick="window.print()">Save as PDF</button> <button class="btn" onclick="window.close()">Close</button></div>${html}</body></html>`);
            win.document.close();
        }

        // Edit Modal Logic
        let editState = { collection: null, id: null, fields: [] };

        function openEditModal(collection, id) {
            const data = LocalDB.getDoc(collection, id);
            if (!data) { notify('Record not found', 'error'); return; }
            editState = { collection, id, fields: Object.keys(data).filter(k => k !== 'id' && k !== 'createdAt') };
            const form = document.getElementById('edit-form');
            form.innerHTML = '';
            
            // Get schema columns for this collection
            const schema = Schema[collection];
            const columns = schema && schema.columns ? schema.columns : [];
            
            // Special handling for investments fields
            if (collection === 'investments') {
                const investorName = data.investor === 'Haji Hayat' ? 'Haji Hayat' : 'Abbas';
                
                // Description
                form.innerHTML += `<div class="form-group">
                    <label class="form-label">Description</label>
                    <input class="input" name="name" value="${data.name || ''}">
                </div>`;
                
                // Investor Amount (labeled as investor name)
                form.innerHTML += `<div class="form-group">
                    <label class="form-label">${investorName} Amount</label>
                    <input class="input" type="number" name="amount" value="${parseFloat(data.amount) || 0}">
                </div>`;
                
                // Paid to
                form.innerHTML += `<div class="form-group">
                    <label class="form-label">Paid to</label>
                    <select class="input" name="paidTo">
                        <option value="Shop" ${data.paidTo === 'Shop' ? 'selected' : ''}>Shop</option>
                        <option value="Real Estate" ${data.paidTo === 'Real Estate' ? 'selected' : ''}>Real Estate</option>
                        <option value="Cash" ${data.paidTo === 'Cash' ? 'selected' : ''}>Cash</option>
                    </select>
                </div>`;
                
                // Date
                form.innerHTML += `<div class="form-group">
                    <label class="form-label">Date</label>
                    <input class="input" type="date" name="date" value="${data.date || ''}">
                </div>`;
                
                // Method
                form.innerHTML += `<div class="form-group">
                    <label class="form-label">Method</label>
                    <select class="input" name="method">
                        <option value="Cash" ${data.method === 'Cash' ? 'selected' : ''}>Cash</option>
                        <option value="Bank Transfer" ${data.method === 'Bank Transfer' ? 'selected' : ''}>Bank Transfer</option>
                    </select>
                </div>`;
                
                // Hidden investor field (don't edit investor directly)
                form.innerHTML += `<input type="hidden" name="investor" value="${data.investor}">`;
                
            } else if (collection === 'invoices') {
                // Special handling for invoices
                form.innerHTML += `<div class="form-group">
                    <label class="form-label">Invoice #</label>
                    <input class="input" name="num" value="${data.num || ''}">
                </div>`;
                
                form.innerHTML += `<div class="form-group">
                    <label class="form-label">Company</label>
                    <input class="input" name="customer" value="${data.customer || ''}">
                </div>`;
                
                form.innerHTML += `<div class="form-group">
                    <label class="form-label">Total Amount</label>
                    <input class="input" type="number" name="amount" value="${parseFloat(data.amount) || 0}">
                </div>`;
                
                form.innerHTML += `<div class="form-group">
                    <label class="form-label">Paid Status</label>
                    <select class="input" name="paid">
                        <option value="No" ${data.paid === 'No' ? 'selected' : ''}>Not Paid</option>
                        <option value="Full" ${data.paid === 'Full' ? 'selected' : ''}>Paid Full</option>
                        <option value="Half" ${data.paid === 'Half' ? 'selected' : ''}>Paid Half</option>
                        <option value="Partially" ${data.paid === 'Partially' ? 'selected' : ''}>Paid Partially</option>
                    </select>
                </div>`;
                
                form.innerHTML += `<div class="form-group">
                    <label class="form-label">Amount Paid</label>
                    <input class="input" type="number" name="amountPaid" value="${parseFloat(data.amountPaid) || 0}">
                </div>`;
                
                form.innerHTML += `<div class="form-group">
                    <label class="form-label">Amount Unpaid</label>
                    <input class="input" type="number" name="amountUnpaid" value="${parseFloat(data.amountUnpaid) || 0}">
                </div>`;
                
                form.innerHTML += `<div class="form-group">
                    <label class="form-label">Date</label>
                    <input class="input" type="date" name="date" value="${data.date || ''}">
                </div>`;
                
                form.innerHTML += `<div class="form-group">
                    <label class="form-label">Paid On</label>
                    <input class="input" type="date" name="paidOn" value="${data.paidOn || ''}">
                </div>`;
                
                form.innerHTML += `<div class="form-group">
                    <label class="form-label">Payment Method</label>
                    <select class="input" name="paymentMethod">
                        <option value="cash" ${data.paymentMethod === 'cash' ? 'selected' : ''}>Cash</option>
                        <option value="bank" ${data.paymentMethod === 'bank' ? 'selected' : ''}>Bank</option>
                        <option value="card" ${data.paymentMethod === 'card' ? 'selected' : ''}>Card</option>
                    </select>
                </div>`;
                
            } else if (columns.length > 0) {
                // Use schema columns for other collections
                columns.forEach(col => {
                    if (!col.key) return; // Skip computed columns
                    const fieldName = col.key;
                    const fieldLabel = col.label;
                    const fieldValue = data[fieldName] ?? '';
                    
                    // Determine input type based on schema type
                    let inputType = 'text';
                    if (col.type === 'currency') inputType = 'number';
                    else if (col.type === 'date') inputType = 'date';
                    
                    // Handle special cases
                    if (fieldName === 'paid' || fieldName === 'status' || fieldName === 'type' || fieldName === 'cashType' || fieldName === 'service') {
                        // These should be dropdowns - we'll detect based on existing values
                        form.innerHTML += `<div class="form-group"><label class="form-label">${fieldLabel}</label><input class="input" name="${fieldName}" value="${fieldValue}"></div>`;
                    } else {
                        form.innerHTML += `<div class="form-group"><label class="form-label">${fieldLabel}</label><input class="input" type="${inputType}" name="${fieldName}" value="${fieldValue}"></div>`;
                    }
                });
            } else {
                // Fallback: generic handling if no schema defined
                editState.fields.forEach(k => {
                    const val = data[k] ?? '';
                    form.innerHTML += `<div class="form-group"><label class="form-label">${k}</label><input class="input" name="${k}" value="${val}"></div>`;
                });
            }
            
            // Show payment history button for invoices
            const paymentHistoryBtn = document.getElementById('payment-history-btn');
            if (collection === 'invoices') {
                paymentHistoryBtn.style.display = 'block';
                paymentHistoryBtn.onclick = () => openPaymentHistoryModal(id, data.num);
            } else {
                paymentHistoryBtn.style.display = 'none';
            }
            
            document.getElementById('edit-modal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('edit-modal').classList.remove('active');
        }

        function saveEdits(e) {
            e.preventDefault();
            const form = document.getElementById('edit-form');
            const updated = {};
            
            if (editState.collection === 'investments') {
                // For investments, map form fields to data fields
                const name = form.querySelector('[name="name"]');
                const amount = form.querySelector('[name="amount"]');
                const paidTo = form.querySelector('[name="paidTo"]');
                const date = form.querySelector('[name="date"]');
                const method = form.querySelector('[name="method"]');
                
                if (name) updated.name = name.value;
                if (amount) updated.amount = parseFloat(amount.value) || 0;
                if (paidTo) updated.paidTo = paidTo.value;
                if (date) updated.date = date.value;
                if (method) updated.method = method.value;
            } else if (editState.collection === 'invoices') {
                // For invoices, map form fields to data fields
                const num = form.querySelector('[name="num"]');
                const customer = form.querySelector('[name="customer"]');
                const amount = form.querySelector('[name="amount"]');
                const paid = form.querySelector('[name="paid"]');
                const amountPaid = form.querySelector('[name="amountPaid"]');
                const amountUnpaid = form.querySelector('[name="amountUnpaid"]');
                const date = form.querySelector('[name="date"]');
                const paidOn = form.querySelector('[name="paidOn"]');
                const paymentMethod = form.querySelector('[name="paymentMethod"]');
                
                if (num) updated.num = num.value;
                if (customer) updated.customer = customer.value;
                if (amount) updated.amount = parseFloat(amount.value) || 0;
                if (paid) updated.paid = paid.value;
                if (amountPaid) updated.amountPaid = parseFloat(amountPaid.value) || 0;
                if (amountUnpaid) updated.amountUnpaid = parseFloat(amountUnpaid.value) || 0;
                if (date) updated.date = date.value;
                if (paidOn) updated.paidOn = paidOn.value;
                if (paymentMethod) updated.paymentMethod = paymentMethod.value;
                updated.status = (paid && paid.value !== 'No') ? 'paid' : 'unpaid';
            } else {
                // Generic handling for other collections
                editState.fields.forEach(k => {
                    const input = form.querySelector(`[name="${k}"]`);
                    updated[k] = input ? (isFinite(input.value) ? parseFloat(input.value) : input.value) : undefined;
                });
            }
            
            updateInCollection(editState.collection, editState.id, updated);
            closeEditModal();
            notify('Record updated successfully!', 'success');
            
            // Auto-refresh the table after a short delay to show updates
            setTimeout(() => {
                const data = LocalDB.getCollection(editState.collection);
                renderTable(editState.collection, data);
            }, 200);
        }

        // Data Sync & Seeding
        async function syncAllFromFirebase() {
            const cols = ['expenses','investments','suppliers','invoices','exchange','cash','outstanding','outstanding_payments','payments'];
            let totalCloud = 0;
            let hasPermissionError = false;
            for (const c of cols) {
                try {
                    const snapshot = await db.collection(resolveColl(c)).get();
                    const data = [];
                    snapshot.forEach(doc => {
                        const raw = { id: doc.id, ...doc.data() };
                        const mapped = mapRead(c, raw);
                        data.push(mapped);
                    });
                    if (data.length) {
                        LocalDB.saveCollection(c, data);
                        renderTable(c, data);
                        totalCloud += data.length;
                    }
                } catch (e) {
                    if (e.code === 'permission-denied') {
                        hasPermissionError = true;
                        console.warn('Firebase sync blocked - check Firestore security rules');
                    } else {
                        console.warn('Sync read error:', e);
                    }
                }
            }
            if (hasPermissionError) {
                notify(`Synced ${totalCloud} local records (Firebase sync disabled - check security rules)`, 'warn');
            } else {
                notify(`Synced ${totalCloud} cloud records`);
            }
        }

        async function seedDemoData() {
            // Avoid duplicate seeding if local data exists
            const cols = ['expenses','investments','suppliers','invoices','exchange','cash','outstanding','outstanding_payments','payments'];
            const existing = cols.reduce((s, c) => s + (LocalDB.getCollection(c).length || 0), 0);
            if (existing > 0) {
                notify('Data already exists; seed skipped', 'warn');
                return;
            }
            const fmt = (d) => d.toISOString().split('T')[0];
            const today = new Date();
            const day = (n) => fmt(new Date(today.getFullYear(), today.getMonth(), today.getDate() - n));

            // Suppliers
            const suppliers = ['Alpha Traders','Beta Supplies','Gamma Imports','Delta Wholesale'];
            for (const name of suppliers) await addToCollection('suppliers', { name });

            // Expenses
            const expenses = [
                { desc:'Store Rent', amount: 1200, date: day(25) },
                { desc:'Utilities', amount: 320, date: day(22) },
                { desc:'Insurance', amount: 150, date: day(20) },
                { desc:'Internet', amount: 80, date: day(18) }
            ];
            for (const r of expenses) await addToCollection('expenses', r);

            // Investments
            const investments = [
                { name:'Initial Capital', investor:'Haji Hayat', amount: 5000, date: day(30), method:'Cash' },
                { name:'Equipment Purchase', investor:'Abbas', amount: 3000, date: day(27), method:'Bank Transfer' },
                { name:'Working Capital', investor:'Haji Hayat', amount: 2000, date: day(15), method:'Cash' }
            ];
            for (const r of investments) await addToCollection('investments', r);

            // Invoices
            const invoices = [
                { num:'INV-001', customer:'Alpha Traders', amount: 750, date: day(14), paid:'Yes', paidOn: day(10) },
                { num:'INV-002', customer:'Beta Supplies', amount: 540, date: day(12), paid:'No', paidOn:'' },
                { num:'INV-003', customer:'Gamma Imports', amount: 920, date: day(8), paid:'Yes', paidOn: day(5) }
            ];
            for (const r of invoices) await addToCollection('invoices', r);

            // Exchange (AUD-only)
            const exchange = [
                { amount: 1000, service:'RIA', cashType:'in', status:'Paid', paidOn: day(9) },
                { amount: 650, service:'Western Union', cashType:'out', status:'Pending', paidOn:'' },
                { amount: 1200, service:'Money Gram', cashType:'in', status:'Paid', paidOn: day(6) }
            ];
            for (const r of exchange) await addToCollection('exchange', r);

            // Cash
            const cash = [
                { desc:'Float Top-up', type:'in', amount: 300, date: day(7) },
                { desc:'Petty Expense', type:'out', amount: 45, date: day(7) }
            ];
            for (const r of cash) await addToCollection('cash', r);

            // Outstanding
            const outstanding = [
                { customer:'Delta Wholesale', amount: 410, date: day(3) }
            ];
            for (const r of outstanding) await addToCollection('outstanding', r);

            notify('Seeded demo data across all tabs');
        }

        async function checkCloudStatus() {
            const el = document.getElementById('cloud-status');
            if (!el) {
                console.warn('cloud-status element not found, skipping cloud status check');
                return;
            }
            el.textContent = 'Checking cloud collections...';
            const cols = ['expenses','investments','suppliers','invoices','exchange','cash','outstanding','outstanding_payments','payments'];
            const cache = getCloudNameCache();
            const rows = [];
            for (const c of cols) {
                let resolved = cache[c] || CollectionMap[c] || c;
                let count = 0;
                let used = resolved;
                let sampleKeys = [];
                const candidates = [resolved, ...(CloudNameCandidates[c] || [])];
                const tried = new Set();
                for (const name of candidates) {
                    if (!name || tried.has(name)) continue;
                    tried.add(name);
                    try {
                        const snap = await db.collection(name).get();
                        count = snap.size;
                        used = name;
                        if (count > 0) {
                            resolved = name;
                            // Fetch one doc to show its field keys
                            try {
                                const sampleSnap = await db.collection(name).limit(1).get();
                                sampleSnap.forEach(doc => {
                                    const data = doc.data() || {};
                                    sampleKeys = Object.keys(data).sort();
                                });
                            } catch {}
                            break;
                        }
                    } catch {}
                }
                cache[c] = resolved;
                rows.push({ tab: c, cloud: used, count, sampleKeys });
            }
            setCloudNameCache(cache);
            const html = `<div class="glass p-4 mt-2"><div class="font-bold mb-2">Cloud Status</div>
                <table style="width:100%;border-collapse:collapse">
                    <thead><tr>
                        <th style="text-align:left;padding:6px;border-bottom:1px solid #e5e7eb">Tab</th>
                        <th style="text-align:left;padding:6px;border-bottom:1px solid #e5e7eb">Cloud Collection</th>
                        <th style="text-align:right;padding:6px;border-bottom:1px solid #e5e7eb">Docs</th>
                        <th style="text-align:left;padding:6px;border-bottom:1px solid #e5e7eb">Sample Keys</th>
                    </tr></thead>
                    <tbody>${rows.map(r => `<tr>
                        <td style='padding:6px;border-bottom:1px solid #e5e7eb'>${r.tab}</td>
                        <td style='padding:6px;border-bottom:1px solid #e5e7eb'>${r.cloud}</td>
                        <td style='padding:6px;border-bottom:1px solid #e5e7eb;text-align:right'>${r.count}</td>
                        <td style='padding:6px;border-bottom:1px solid #e5e7eb'>${(r.sampleKeys||[]).join(', ')}</td>
                    </tr>`).join('')}</tbody>
                </table></div>`;
            el.innerHTML = html;
        }

        function loadSchemaMapUI() {
            const fm = getFieldMap();
            const el = document.getElementById('schema-map-json');
            if (el) el.value = JSON.stringify(fm, null, 2);
        }
        function saveSchemaMapUI() {
            const el = document.getElementById('schema-map-json');
            if (!el) return;
            const txt = el.value;
            try {
                const obj = JSON.parse(txt || '{}');
                setFieldMap(obj);
                notify('Saved field mapping');
                ['expenses','investments','suppliers','invoices','exchange','cash','outstanding','outstanding_payments','payments'].forEach(col => loadCollection(col));
            } catch (e) {
                notify('Invalid JSON mapping', 'error');
            }
        }

        // Backup/Import removed per your preference

        // Initialize
        async function updateConnectionStatus() {
            const el = document.getElementById('connection-status');
            try {
                await db.collection('expenses').limit(1).get();
                el.textContent = ' Connected to Firebase';
            } catch (e) {
                el.textContent = ' Offline mode (LocalDB)';
            }
        }

        window.addEventListener('error', (e) => {
            notify(`Error: ${e.message}`, 'error');
        });
        window.addEventListener('unhandledrejection', (e) => {
            notify(`Error: ${e.reason && e.reason.message ? e.reason.message : e.reason}`, 'error');
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Force-remove any old PWA caches/service workers from previous app versions
            (async () => {
                try {
                    // Only attempt service worker cleanup if we're in a proper protocol (not null/file)
                    if ('serviceWorker' in navigator && window.location.protocol !== 'null:') {
                        try {
                            const regs = await navigator.serviceWorker.getRegistrations();
                            regs.forEach(r => r.unregister());
                        } catch (swErr) {
                            console.warn('Service worker cleanup skipped:', swErr.message);
                        }
                    }
                    if (window.caches && caches.keys) {
                        try {
                            const keys = await caches.keys();
                            await Promise.all(keys.map(k => caches.delete(k)));
                        } catch (cacheErr) {
                            console.warn('Cache cleanup skipped:', cacheErr.message);
                        }
                    }
                    console.log(' Cleared old service workers and caches');
                } catch (e) {
                    console.warn('Cleanup error:', e.message);
                }
            })();

            document.getElementById('expense-date').valueAsDate = new Date();
            document.getElementById('inv-date').valueAsDate = new Date();
            const invoiceDateEl = document.getElementById('inv-invoice-date');
            if (invoiceDateEl) invoiceDateEl.valueAsDate = new Date();
            document.getElementById('out-date').valueAsDate = new Date();
            const suppDateEl = document.getElementById('supp-date');
            if (suppDateEl) suppDateEl.valueAsDate = new Date();
            bindTabClicks();
            
            // Update connection status by probing Firestore
            updateConnectionStatus();
            
            // Prefill field mapping defaults if empty
            try {
                const fmExisting = getFieldMap();
                if (!fmExisting || Object.keys(fmExisting).length === 0) {
                    const fmDefault = {
                        expenses: { desc: 'desc', amount: 'amount', date: 'date' },
                        // Cloud 'name' corresponds to local 'investor'
                        investments: { investor: 'name', amount: 'amount', date: 'date', paidTo: 'paidTo', method: 'method' },
                        suppliers: { name: 'name', phone: 'phone', details: 'details' },
                        invoices: { num: 'invoiceNumber', customer: 'customer', amount: 'totalAmount', date: 'date', paidOn: 'paidOn', paymentMethod: 'paymentMethod', bsb: 'bsb', gstRate: 'gstRate', gstAmount: 'gstAmount', netAmount: 'netAmount', amountPaid: 'amountPaid', amountUnpaid: 'amountUnpaid', gstType: 'gstType' },
                        exchange: { amount: 'amount', service: 'service', cashType: 'cashType', status: 'status', paidOn: 'paidOn' },
                        cash: { desc: 'desc', type: 'type', amount: 'amount', date: 'date' },
                        outstanding: { customer: 'customer', amount: 'amount', date: 'date' },
                        outstanding_payments: { outstandingId: 'outstandingId', customer: 'customer', amount: 'amount', paidOn: 'paidOn', paymentMethod: 'paymentMethod' },
                        payments: { invoiceNum: 'invoiceNum', invoiceId: 'invoiceId', customer: 'customer', amount: 'amount', paidOn: 'paidOn', paymentMethod: 'paymentMethod' }
                    };
                    setFieldMap(fmDefault);
                    const schemaEl = document.getElementById('schema-map-json');
                    if (schemaEl) schemaEl.value = JSON.stringify(fmDefault, null, 2);
                }
            } catch (e) {
                console.warn('Field mapping init error:', e);
            }

            // Load all collections then perform a cloud sync to ensure latest data is shown
            const collections = ['expenses', 'investments', 'suppliers', 'invoices', 'exchange', 'cash', 'outstanding', 'outstanding_payments', 'payments'];
            collections.forEach(col => loadCollection(col));
            
            // Restore previous tab state after a short delay to ensure DOM is ready
            setTimeout(() => {
                try {
                    const savedTab = localStorage.getItem('currentTab');
                    if (savedTab && document.getElementById(`tab-${savedTab}`)) {
                        const tabBtn = document.querySelector(`[data-tab="${savedTab}"]`);
                        if (tabBtn) {
                            switchTab(tabBtn, savedTab);
                            // If investments tab, also restore the investment subtab
                            if (savedTab === 'investments') {
                                const savedInvTab = localStorage.getItem('currentInvTab') || 'all';
                                switchInvTab(savedInvTab);
                            }
                        }
                    } else {
                        // Default to expenses tab if no saved state
                        const expensesBtn = document.querySelector('[data-tab="expenses"]');
                        if (expensesBtn) switchTab(expensesBtn, 'expenses');
                    }
                } catch (e) {
                    console.warn('Tab state restore error:', e);
                    // Default to expenses tab on error
                    const expensesBtn = document.querySelector('[data-tab="expenses"]');
                    if (expensesBtn) switchTab(expensesBtn, 'expenses');
                }
            }, 100);
            // Light delay to avoid blocking UI
            setTimeout(() => { syncAllFromFirebase(); }, 300);
            // Setup invoice form listeners
            setTimeout(() => { setupInvoiceFormListeners(); }, 50);
            // After syncing, auto-check cloud status to show sample keys
            setTimeout(() => { checkCloudStatus(); }, 600);
            // Populate company autocomplete
            refreshCompaniesDatalist();
            
            const build = '2026-01-29T' + new Date().toTimeString().slice(0,8);
            document.getElementById('build-version').textContent = `Build: ${build}`;
            console.log(' Gulistan Supermarket & Halal Meat Initialized');
            console.log(' Firebase Firestore Connected');
            console.log(' Build version:', build);

            // Note: Paid On enable/disable now handled in setupInvoiceFormListeners()

            const excStatusSel = document.getElementById('exc-status');
            const excPaidOn = document.getElementById('exc-paid-on');
            if (excStatusSel && excPaidOn) {
                excPaidOn.disabled = false;
                excStatusSel.addEventListener('change', () => {
                    if (excStatusSel.value !== 'Paid') excPaidOn.value = '';
                    excPaidOn.disabled = false;
                });
            }

            // Smart search bindings per tab
            ['invoices','exchange','investments','suppliers'].forEach(tab => {
                const input = document.getElementById(`${tab}-search`);
                if (!input) return;
                input.addEventListener('input', () => {
                    const q = normalizeKey(input.value);
                    const rows = LocalDB.getCollection(tab);
                    let filtered;
                    if (tab === 'invoices') {
                        filtered = rows.filter(r => {
                            const invNum = normalizeKey(r.num || '');
                            const customer = normalizeKey(r.customer || '');
                            const paid = normalizeKey(r.paid || '');
                            const method = normalizeKey(r.paymentMethod || '');
                            const date = normalizeKey(r.date || '');
                            const amount = normalizeKey(r.amount || '');
                            return invNum.includes(q) || customer.includes(q) || paid.includes(q) || method.includes(q) || date.includes(q) || amount.includes(q);
                        });
                    } else {
                        filtered = rows.filter(r => normalizeKey(JSON.stringify(r)).includes(q));
                    }
                    renderTable(tab, filtered);
                });
            });

            // Investment investor tab searches
            const hayatSearch = document.getElementById('inv-hayat-search');
            if (hayatSearch) {
                hayatSearch.addEventListener('input', () => {
                    const q = normalizeKey(hayatSearch.value);
                    const rows = LocalDB.getCollection('investments').filter(r => r.investor === 'Haji Hayat');
                    const filtered = rows.filter(r => normalizeKey(JSON.stringify(r)).includes(q));
                    renderTableToContainer('investments', filtered, 'investments-hayat-table');
                    updateInvestorTotal('hayat', filtered);
                });
            }

            const abbasSearch = document.getElementById('inv-abbas-search');
            if (abbasSearch) {
                abbasSearch.addEventListener('input', () => {
                    const q = normalizeKey(abbasSearch.value);
                    const rows = LocalDB.getCollection('investments').filter(r => r.investor === 'Abbas');
                    const filtered = rows.filter(r => normalizeKey(JSON.stringify(r)).includes(q));
                    renderTableToContainer('investments', filtered, 'investments-abbas-table');
                    updateInvestorTotal('abbas', filtered);
                });
            }
        });

        // Company autocomplete list (based on existing invoices + suppliers)
        function refreshCompaniesDatalist() {
            const elId = 'companies-list';
            let dl = document.getElementById(elId);
            if (!dl) {
                dl = document.createElement('datalist');
                dl.id = elId;
                document.body.appendChild(dl);
            }
            const names = new Set();
            LocalDB.getCollection('suppliers').forEach(s => { if (s.name) names.add(s.name); });
            LocalDB.getCollection('invoices').forEach(i => { if (i.customer) names.add(i.customer); });
            dl.innerHTML = Array.from(names).sort().map(n => `<option value="${n}"></option>`).join('');
            const quickSel = document.getElementById('suppliers-quick-select');
            if (quickSel) {
                quickSel.innerHTML = '<option value="">Select company...</option>' + Array.from(names).sort().map(n => `<option value="${n}">${n}</option>`).join('');
            }
            setupFirstLetterAutocomplete('inv-customer', 'companies-list');
        }

        function addSupplierQuick() {
            const sel = document.getElementById('suppliers-quick-select');
            const name = normalizeName(sel ? sel.value : '');
            if (!name) return notify('Select a company to add', 'error');
            const existing = LocalDB.getCollection('suppliers');
            if (existing.some(s => normalizeName(s.name) === name)) {
                return notify('Supplier already exists', 'warn');
            }
            addToCollection('suppliers', { name });
            notify('Supplier added');
            refreshCompaniesDatalist();
        }

        // Printing helpers
        function buildPrintHeader(title, supplierInfo = null, invoiceDate = null) {
            const logo = '<div style="text-align:center;margin-bottom:12px"><img src="data:image/png;base64,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" alt="Gulistan Logo" style="max-height:80px;width:auto" onerror="this.style.display=\'none\'"></div>';
            const company = '<div style="font-weight:700;font-size:18px;text-align:center;color:#1e3a8a">Gulistan Supermarket & Halal Meat</div>';
            const companyDetails = '<div style="text-align:center;font-size:12px;color:#374151;margin-bottom:8px">187-189 Thomas st Dandenong</div>';
            const dateTime = `<div style="font-size:11px;color:#6b7280;text-align:center;margin-bottom:12px">${new Date().toLocaleString()}${invoiceDate ? ` | Invoice Date: ${formatDate(invoiceDate)}` : ''}</div>`;
            const titleSection = `<div style="margin-top:12px;margin-bottom:12px;font-weight:700;font-size:16px;text-align:center;border-bottom:2px solid #1e3a8a;padding-bottom:8px">${title}</div>`;
            let supplierSection = '';
            if (supplierInfo) {
                supplierSection = `<div style="background:#f3f4f6;padding:10px;border-radius:6px;margin-bottom:12px;border-left:4px solid #1e3a8a">
                    <div style="font-weight:600;color:#1e3a8a;margin-bottom:6px">Supplier Information</div>
                    <div style="font-size:12px;color:#374151;line-height:1.6">
                        <div><strong>Company:</strong> ${supplierInfo.name || 'N/A'}</div>
                        ${supplierInfo.phone ? `<div><strong>Phone:</strong> <a href="tel:${supplierInfo.phone}" style="color:#3b82f6;text-decoration:none">${supplierInfo.phone}</a></div>` : ''}
                        ${supplierInfo.details ? `<div><strong>Details:</strong> ${supplierInfo.details}</div>` : ''}
                    </div>
                </div>`;
            }
            return `<div class="print-header">${logo}${company}${companyDetails}${dateTime}${titleSection}${supplierSection}</div>`;
        }

        function buildSummaryHTML(collection, rows) {
            const schema = Schema[collection];
            const parts = [];
            if (schema && Array.isArray(schema.totals)) {
                for (const t of schema.totals) {
                    if (typeof t.reducer === 'function') {
                        const val = t.reducer(rows);
                        parts.push(`${t.label}: ${typeof val === 'number' ? formatCurrency(val) : val}`);
                    } else if (t.key) {
                        const filtered = t.filter ? rows.filter(t.filter) : rows;
                        const sum = filtered.reduce((s, r) => s + (parseFloat(r[t.key]) || 0), 0);
                        parts.push(`${t.label}: ${formatCurrency(sum)}`);
                    }
                }
            }
            // Additional summaries per collection
            if (collection === 'investments') {
                const hayat = rows.filter(r => r.investor === 'Haji Hayat').reduce((s, r) => s + (parseFloat(r.amount)||0), 0);
                const abbas = rows.filter(r => r.investor === 'Abbas').reduce((s, r) => s + (parseFloat(r.amount)||0), 0);
                parts.push(`Haji Hayat: ${formatCurrency(hayat)}`);
                parts.push(`Abbas: ${formatCurrency(abbas)}`);
                const methodCash = rows.filter(r => r.method === 'Cash').reduce((s, r) => s + (parseFloat(r.amount)||0), 0);
                const methodBank = rows.filter(r => r.method === 'Bank Transfer').reduce((s, r) => s + (parseFloat(r.amount)||0), 0);
                parts.push(`Cash: ${formatCurrency(methodCash)}`);
                parts.push(`Bank Transfer: ${formatCurrency(methodBank)}`);
            } else if (collection === 'suppliers') {
                parts.push(`Suppliers Count: ${rows.length}`);
            }
            if (!parts.length) return '';
            return `<div style="margin-top:12px"><div style="font-weight:600;margin-bottom:6px">Summary</div><ul style="list-style:none;padding:0;margin:0">${parts.map(p => `<li style="margin-bottom:4px">${p}</li>`).join('')}</ul></div>`;
        }

        function getMonthKey(d) {
            const date = new Date(d || Date.now());
            const y = date.getFullYear();
            const m = (date.getMonth() + 1).toString().padStart(2, '0');
            return `${y}-${m}`;
        }

        function buildMonthlySection(collection, rows) {
            const fieldMap = { expenses:'amount', investments:'amount', invoices:'amount', exchange:'amount', cash:'amount', outstanding:'amount' };
            const field = fieldMap[collection];
            if (!field) return '';
            // Invoices: monthly Paid vs Unpaid columns
            if (collection === 'invoices') {
                const monthly = new Map();
                rows.forEach(r => {
                    const key = getMonthKey(r.date || r.createdAt);
                    const amt = parseFloat(r.amount) || 0;
                    const isPaid = (r.paid !== 'No');
                    const cur = monthly.get(key) || { paid:0, unpaid:0 };
                    if (isPaid) cur.paid += amt; else cur.unpaid += amt;
                    monthly.set(key, cur);
                });
                if (!monthly.size) return '';
                const rowsHtml = Array.from(monthly.entries()).sort(([a],[b]) => a.localeCompare(b))
                    .map(([mon, o]) => {
                        const total = (o.paid||0) + (o.unpaid||0);
                        return `<tr><td style="padding:6px;border-bottom:1px solid #e5e7eb">${mon}</td><td style="padding:6px;border-bottom:1px solid #e5e7eb;text-align:right">${formatCurrency(o.paid||0)}</td><td style="padding:6px;border-bottom:1px solid #e5e7eb;text-align:right">${formatCurrency(o.unpaid||0)}</td><td style="padding:6px;border-bottom:1px solid #e5e7eb;text-align:right">${formatCurrency(total)}</td></tr>`;
                    })
                    .join('');
                return `<div style="margin-top:12px"><div style="font-weight:600;margin-bottom:6px">Monthly Breakdown</div><table style="width:100%;border-collapse:collapse"><thead><tr><th style="text-align:left;padding:6px;border-bottom:1px solid #e5e7eb">Month</th><th style="text-align:right;padding:6px;border-bottom:1px solid #e5e7eb">Paid</th><th style="text-align:right;padding:6px;border-bottom:1px solid #e5e7eb">Unpaid</th><th style="text-align:right;padding:6px;border-bottom:1px solid #e5e7eb">Total</th></tr></thead><tbody>${rowsHtml}</tbody></table></div>`;
            }
            // Exchange: monthly totals and Cash In/Out
            if (collection === 'exchange') {
                // First section: Amount, Cash In, Cash Out
                const monthly = new Map();
                rows.forEach(r => {
                    const key = getMonthKey(r.date || r.createdAt);
                    const amt = parseFloat(r.amount) || 0;
                    const cur = monthly.get(key) || { amount:0, in:0, out:0 };
                    cur.amount += amt;
                    if (r.cashType === 'in') cur.in += amt; else if (r.cashType === 'out') cur.out += amt;
                    monthly.set(key, cur);
                });
                if (!monthly.size) return '';
                const rowsHtml1 = Array.from(monthly.entries()).sort(([a],[b]) => a.localeCompare(b))
                    .map(([mon, o]) => `<tr><td style="padding:6px;border-bottom:1px solid #e5e7eb">${mon}</td><td style="padding:6px;border-bottom:1px solid #e5e7eb;text-align:right">${formatCurrency(o.amount||0)}</td><td style="padding:6px;border-bottom:1px solid #e5e7eb;text-align:right">${formatCurrency(o.in||0)}</td><td style="padding:6px;border-bottom:1px solid #e5e7eb;text-align:right">${formatCurrency(o.out||0)}</td></tr>`)
                    .join('');
                const section1 = `<div style="margin-top:12px"><div style="font-weight:600;margin-bottom:6px">Monthly Breakdown</div><table style="width:100%;border-collapse:collapse"><thead><tr><th style="text-align:left;padding:6px;border-bottom:1px solid #e5e7eb">Month</th><th style="text-align:right;padding:6px;border-bottom:1px solid #e5e7eb">Amount</th><th style=\"text-align:right;padding:6px;border-bottom:1px solid #e5e7eb\">Cash In</th><th style=\"text-align:right;padding:6px;border-bottom:1px solid #e5e7eb\">Cash Out</th></tr></thead><tbody>${rowsHtml1}</tbody></table></div>`;

                // Second section: Per-service totals per month (based on To Amount)
                const monthlySvc = new Map();
                rows.forEach(r => {
                    const key = getMonthKey(r.date || r.createdAt);
                    const to = parseFloat(r.amount) || 0;
                    const svc = r.service || 'Other';
                    const cur = monthlySvc.get(key) || { RIA:0, 'Western Union':0, 'Money Gram':0, Hawala:0 };
                    if (svc in cur) cur[svc] += to;
                    monthlySvc.set(key, cur);
                });
                const rowsHtml2 = Array.from(monthlySvc.entries()).sort(([a],[b]) => a.localeCompare(b))
                    .map(([mon, o]) => `<tr><td style="padding:6px;border-bottom:1px solid #e5e7eb">${mon}</td><td style="padding:6px;border-bottom:1px solid #e5e7eb;text-align:right">${formatCurrency(o['RIA']||0)}</td><td style="padding:6px;border-bottom:1px solid #e5e7eb;text-align:right">${formatCurrency(o['Western Union']||0)}</td><td style="padding:6px;border-bottom:1px solid #e5e7eb;text-align:right">${formatCurrency(o['Money Gram']||0)}</td><td style="padding:6px;border-bottom:1px solid #e5e7eb;text-align:right">${formatCurrency(o['Hawala']||0)}</td></tr>`)
                    .join('');
                const section2 = `<div style="margin-top:12px"><div style="font-weight:600;margin-bottom:6px">Monthly by Service</div><table style="width:100%;border-collapse:collapse"><thead><tr><th style="text-align:left;padding:6px;border-bottom:1px solid #e5e7eb">Month</th><th style="text-align:right;padding:6px;border-bottom:1px solid #e5e7eb">RIA</th><th style="text-align:right;padding:6px;border-bottom:1px solid #e5e7eb">Western Union</th><th style="text-align:right;padding:6px;border-bottom:1px solid #e5e7eb">Money Gram</th><th style="text-align:right;padding:6px;border-bottom:1px solid #e5e7eb">Hawala</th></tr></thead><tbody>${rowsHtml2}</tbody></table></div>`;
                return section1 + section2;
            }
            // Default: single Total column per month
            const monthly = new Map();
            rows.forEach(r => {
                const key = getMonthKey(r.date || r.createdAt);
                const val = parseFloat(r[field]) || 0;
                monthly.set(key, (monthly.get(key) || 0) + val);
            });
            if (!monthly.size) return '';
            const rowsHtml = Array.from(monthly.entries()).sort(([a],[b]) => a.localeCompare(b))
                .map(([mon, total]) => `<tr><td style="padding:6px;border-bottom:1px solid #e5e7eb">${mon}</td><td style="padding:6px;border-bottom:1px solid #e5e7eb;text-align:right">${formatCurrency(total)}</td></tr>`)
                .join('');
            return `<div style="margin-top:12px"><div style="font-weight:600;margin-bottom:6px">Monthly Breakdown</div><table style="width:100%;border-collapse:collapse"><thead><tr><th style="text-align:left;padding:6px;border-bottom:1px solid #e5e7eb">Month</th><th style="text-align:right;padding:6px;border-bottom:1px solid #e5e7eb">Total</th></tr></thead><tbody>${rowsHtml}</tbody></table></div>`;
        }

        function printTable(collection) {
            const rows = LocalDB.getCollection(collection);
            const schema = Schema[collection];
            const cols = (schema && schema.columns) ? schema.columns : Object.keys(rows[0]||{}).filter(k => k!=='id' && k!=='createdAt').map(k => ({key:k,label:k}));
            let html = buildPrintHeader(`${collection.toUpperCase()} Report`);
            html += '<table style="width:100%;border-collapse:collapse">';
            html += '<thead><tr>' + cols.map(c => `<th style="border-bottom:1px solid #e5e7eb;padding:8px;text-align:left">${c.label}</th>`).join('') + '</tr></thead><tbody>';
            rows.forEach(r => {
                html += '<tr>' + cols.map(c => {
                    let val = r[c.key];
                    if (c.type==='currency') val = formatCurrency(val);
                    else if (c.type==='date') val = formatDate(val);
                    return `<td style="border-bottom:1px solid #e5e7eb;padding:8px">${val ?? ''}</td>`;
                }).join('') + '</tr>';
            });
            html += '</tbody></table>';
            const win = window.open('', '_blank');
            if (!win) return notify('Popup blocked: enable popups to print', 'error');
            win.document.write(`<html><head><title>${collection} Report</title>
            <style>body{font-family:Segoe UI,Tahoma,sans-serif;padding:16px} .bar{display:flex;gap:8px;justify-content:flex-end;margin-bottom:8px}</style>
            </head><body>
            <div class="bar"><button onclick="window.close()">Back to App</button><button onclick="window.print()">Print</button></div>
            ${html}
            </body></html>`);
            win.document.close();
            win.focus();
        }

        function printRow(collection, id) {
            const row = LocalDB.getDoc(collection, id);
            if (!row) return notify('Record not found', 'error');
            const schema = Schema[collection];
            const cols = (schema && schema.columns) ? schema.columns : Object.keys(row).filter(k => k!=='id' && k!=='createdAt').map(k => ({key:k,label:k}));
            let html = buildPrintHeader(`${collection.toUpperCase()} Item`);
            html += '<table style="width:100%;border-collapse:collapse">';
            cols.forEach(c => {
                let val = row[c.key];
                if (c.type==='currency') val = formatCurrency(val);
                else if (c.type==='date') val = formatDate(val);
                html += `<tr><th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb">${c.label}</th><td style="padding:8px;border-bottom:1px solid #e5e7eb">${val ?? ''}</td></tr>`;
            });
            html += '</table>';
            
            // Add payment history for invoices
            if (collection === 'invoices') {
                const payments = getInvoicePayments(row.num);
                if (payments.length > 0) {
                    html += '<h3 style="margin-top:20px;margin-bottom:10px">Payment History</h3>';
                    html += '<table style="width:100%;border-collapse:collapse">';
                    html += '<thead><tr style="background:#f3f4f6"><th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb">Date</th><th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb">Amount</th><th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb">Method</th></tr></thead>';
                    payments.forEach(p => {
                        html += `<tr><td style="padding:8px;border-bottom:1px solid #e5e7eb">${formatDate(p.paidOn)}</td><td style="padding:8px;border-bottom:1px solid #e5e7eb">${formatCurrency(p.amount)}</td><td style="padding:8px;border-bottom:1px solid #e5e7eb">${p.paymentMethod}</td></tr>`;
                    });
                    html += '</table>';
                }
            }
            
            const win = window.open('', '_blank');
            if (!win) return notify('Popup blocked: enable popups to print', 'error');
            win.document.write(`<html><head><title>${collection} Item</title>
            <style>body{font-family:Segoe UI,Tahoma,sans-serif;padding:16px} .bar{display:flex;gap:8px;justify-content:flex-end;margin-bottom:8px}</style>
            </head><body>
            <div class="bar"><button onclick="window.close()">Back to App</button><button onclick="window.print()">Print</button></div>
            ${html}
            </body></html>`);
            win.document.close();
            win.focus();
        }

        // Print Preview helpers
        function openPrintPreviewHTML(title, html, shareText) {
            const container = document.getElementById('print-content');
            container.innerHTML = buildPrintHeader(title) + html;
            container.dataset.shareText = shareText || '';
            document.getElementById('print-overlay').classList.add('active');
        }

        function closePrintPreview() {
            document.getElementById('print-overlay').classList.remove('active');
            document.getElementById('print-content').innerHTML = '';
        }

        function printFromOverlay() {
            window.print();
        }

        async function shareFromOverlay() {
            try {
                const element = document.getElementById('print-content');
                const { jsPDF } = window.jspdf;
                
                if (!element || !jsPDF) {
                    const txt = element ? element.dataset.shareText : '';
                    if (!txt) return notify('Nothing to share', 'error');
                    if (navigator.share) {
                        await navigator.share({ title: 'Report', text: txt });
                    } else {
                        await navigator.clipboard.writeText(txt);
                        notify('Copied summary to clipboard');
                    }
                    return;
                }
                
                notify('Generating PDF...', 'info');
                const canvas = await html2canvas(element, { scale: 2, logging: false });
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 210;
                const pageHeight = 297;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                const pdfBlob = pdf.output('blob');
                const pdfFile = new File([pdfBlob], 'gulistan-report.pdf', { type: 'application/pdf' });
                
                if (navigator.share && navigator.canShare && navigator.canShare({ files: [pdfFile] })) {
                    await navigator.share({ files: [pdfFile], title: 'Gulistan Report' });
                    notify('PDF shared successfully', 'success');
                } else {
                    pdf.save('gulistan-report.pdf');
                    notify('PDF downloaded', 'success');
                }
            } catch (e) {
                console.error('Share error:', e);
                notify('Error generating PDF: ' + e.message, 'error');
            }
        }

        function openPrintPreviewForTable(collection) {
            const rows = LocalDB.getCollection(collection);
            const schema = Schema[collection];
            const cols = (schema && schema.columns) ? schema.columns : Object.keys(rows[0]||{}).filter(k => k!=='id' && k!=='createdAt').map(k => ({key:k,label:k}));
            let table = '<table style="width:100%;border-collapse:collapse">';
            table += '<thead><tr>' + cols.map(c => `<th style="border-bottom:1px solid #e5e7eb;padding:8px;text-align:left">${c.label}</th>`).join('') + '</tr></thead><tbody>';
            rows.forEach(r => {
                table += '<tr>' + cols.map(c => {
                    let val = r[c.key];
                    if (c.type==='currency') val = formatCurrency(val);
                    else if (c.type==='date') val = formatDate(val);
                    return `<td style="border-bottom:1px solid #e5e7eb;padding:8px">${val ?? ''}</td>`;
                }).join('') + '</tr>';
            });
            table += '</tbody></table>';
            const summary = buildSummaryHTML(collection, rows);
            const monthly = buildMonthlySection(collection, rows);
            const shareText = rows.map(r => cols.map(c => `${c.label}: ${r[c.key] ?? ''}`).join(' | ')).join('\n')
                + (summary ? `\n\n${summary.replace(/<[^>]+>/g,'')}` : '')
                + (monthly ? `\n\n${monthly.replace(/<[^>]+>/g,'')}` : '');
            openPrintPreviewHTML(`${collection.toUpperCase()} Report`, table + summary + monthly, shareText);
        }

        function openPrintPreviewForRow(collection, id) {
            const row = LocalDB.getDoc(collection, id);
            if (!row) return notify('Record not found', 'error');
            const schema = Schema[collection];
            const cols = (schema && schema.columns) ? schema.columns : Object.keys(row).filter(k => k!=='id' && k!=='createdAt').map(k => ({key:k,label:k}));
            
            // Get supplier info for invoices
            let supplierInfo = null;
            if (collection === 'invoices' && row.customer) {
                const suppliers = LocalDB.getCollection('suppliers');
                const supplier = suppliers.find(s => s.name === row.customer);
                if (supplier) {
                    supplierInfo = { name: supplier.name, phone: supplier.phone, details: supplier.details };
                } else {
                    supplierInfo = { name: row.customer };
                }
            }
            
            let table = '<table style="width:100%;border-collapse:collapse">';
            cols.forEach(c => {
                let val = row[c.key];
                if (c.type==='currency') val = formatCurrency(val);
                else if (c.type==='date') val = formatDate(val);
                table += `<tr><th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb">${c.label}</th><td style="padding:8px;border-bottom:1px solid #e5e7eb">${val ?? ''}</td></tr>`;
            });
            table += '</table>';
            
            // Add payment history for invoices
            if (collection === 'invoices') {
                const payments = getInvoicePayments(row.num);
                if (payments.length > 0) {
                    table += '<h3 style="margin-top:20px;margin-bottom:10px">Payment History</h3>';
                    table += '<table style="width:100%;border-collapse:collapse">';
                    table += '<thead><tr style="background:#f3f4f6"><th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb">Date</th><th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb">Amount</th><th style="text-align:left;padding:8px;border-bottom:1px solid #e5e7eb">Method</th></tr></thead>';
                    payments.forEach(p => {
                        table += `<tr><td style="padding:8px;border-bottom:1px solid #e5e7eb">${formatDate(p.paidOn)}</td><td style="padding:8px;border-bottom:1px solid #e5e7eb">${formatCurrency(p.amount)}</td><td style="padding:8px;border-bottom:1px solid #e5e7eb">${p.paymentMethod}</td></tr>`;
                    });
                    table += '</table>';
                }
            }
            
            const shareText = cols.map(c => `${c.label}: ${row[c.key] ?? ''}`).join(' | ');
            const container = document.getElementById('print-content');
            const invoiceDate = collection === 'invoices' ? row.date : null;
            container.innerHTML = buildPrintHeader(`${collection.toUpperCase()} Item`, supplierInfo, invoiceDate) + table;
            container.dataset.shareText = shareText || '';
            document.getElementById('print-overlay').classList.add('active');
        }

        function exportCSV(collection) {
            const rows = LocalDB.getCollection(collection);
            if (!rows.length) return notify('No data to export', 'error');
            const headers = Object.keys(rows[0]).filter(k => k!=='id' && k!=='createdAt');
            const csv = [headers.join(',')].concat(rows.map(r => headers.map(h => JSON.stringify(r[h] ?? '')).join(','))).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${collection}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        async function shareTable(collection) {
            const rows = LocalDB.getCollection(collection);
            if (!rows.length) return notify('No data to share', 'error');
            
            try {
                notify('Generating PDF...', 'info');
                openPrintPreviewForTable(collection);
                await new Promise(resolve => setTimeout(resolve, 500));
                await shareFromOverlay();
            } catch (e) {
                console.error('Share error:', e);
                const headers = Object.keys(rows[0]).filter(k => k!=='id' && k!=='createdAt');
                const text = rows.map(r => headers.map(h => `${h}: ${r[h] ?? ''}`).join(' | ')).join('\n');
                if (navigator.share) {
                    try {
                        await navigator.share({ title: `${collection} report`, text });
                    } catch (e2) { notify('Share cancelled', 'error'); }
                } else {
                    await navigator.clipboard.writeText(text);
                    notify('Copied summary to clipboard');
                }
            }
        }
        
        async function shareInvestorTab(investor) {
            try {
                const investorName = investor === 'hayat' ? 'Haji Hayat' : 'Abbas';
                // Export as PDF first, then share
                await exportInvestmentsPDF(investor);
                notify(`${investorName} PDF exported and ready to share`, 'success');
            } catch (e) {
                notify(`Error sharing ${investor} data: ${e.message}`, 'error');
            }
        }
    </script>
    
    <!-- Browser Compatibility Script -->
    <script>
        // Detect browser and add compatibility flags
        const userAgent = navigator.userAgent;
        const isChrome = /Chrome/.test(userAgent) && /Google Inc/.test(navigator.vendor);
        const isFirefox = /Firefox/.test(userAgent);
        const isSafari = /Safari/.test(userAgent) && !/Chrome/.test(userAgent);
        const isEdge = /Edg/.test(userAgent);
        
        // Store browser info in window for conditional fixes
        window.browserInfo = {
            isChrome,
            isFirefox,
            isSafari,
            isEdge,
            isMobile: /iPhone|iPad|iPod|Android/.test(userAgent)
        };
        
        // Fix for Safari iOS viewport height issue
        if (window.browserInfo.isSafari && window.browserInfo.isMobile) {
            const fixViewportHeight = () => {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            };
            fixViewportHeight();
            window.addEventListener('resize', fixViewportHeight);
            window.addEventListener('orientationchange', fixViewportHeight);
            // Use CSS variable for height: height: 100vh; /* fallback */ height: calc(var(--vh, 1vh) * 100);
        }
        
        // Polyfill for Object.hasOwn (Edge/older Safari)
        if (typeof Object.hasOwn !== 'function') {
            Object.hasOwn = function(obj, prop) {
                return Object.prototype.hasOwnProperty.call(obj, prop);
            };
        }
        
        // Polyfill for String.prototype.replaceAll (older Edge)
        if (!String.prototype.replaceAll) {
            String.prototype.replaceAll = function(str, newStr) {
                if (Object.prototype.toString.call(str) === '[object RegExp]') {
                    return this.replace(str, newStr);
                }
                return this.replace(new RegExp(str, 'g'), newStr);
            };
        }
        
        // Fix for Firefox localStorage in private mode
        if (window.browserInfo.isFirefox) {
            const testStorage = () => {
                try {
                    const test = '__test__';
                    localStorage.setItem(test, test);
                    localStorage.removeItem(test);
                    return true;
                } catch (e) {
                    return false;
                }
            };
            window.storageAvailable = testStorage();
        }
        
        console.log(' Browser Compatibility initialized:', window.browserInfo);
    </script>
</body>
</html>
